!function(t,n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define("JZZ",[],n);else{if(t||(t=window),t.JZZ&&t.JZZ.MIDI)return;t.JZZ=n()}}(this,(function(){var t,n,e,r,i,o="undefined"==typeof window?global:window,s="1.8.1",u=Date.now||function(){return(new Date).getTime()},a=u(),c="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return u()-a},h=function(t){setTimeout(t,0)};function f(){}function p(t){return"function"==typeof t}function l(){this._orig=this,this._ready=!1,this._queue=[],this._log=[]}function d(t,n){this._bad?p(n)&&n.apply(this,[new Error(this._err())]):p(t)&&t.apply(this,[this])}function m(t,n){this._bad?t._crash(this._err()):setTimeout((function(){t._resume()}),n)}function g(t){this._bad&&t._break(this._err()),t._resume()}function _(t,n,e){t[e]=function(){var t=arguments,r=n._image();return this._push(g,[r]),r[e].apply(r,t)}}function v(t){this._bad||(p(t)?t.apply(this):console.log(t))}function y(t){this._bad&&(p(t)?t.apply(this):console.log(t))}function b(t){this._bad?t._crash(this._err()):(this._break("Closed"),t._resume())}function C(t){if(t.length){var n=t.shift();if(t.length){var e=this;this._slip(y,[function(){C.apply(e,[t])}])}try{this._repair(),n.apply(this)}catch(t){this._break(t.toString())}}else this._break()}function M(t,n){for(var e=0;e<t.length;e++)if(t[e]===n)return;t.push(n)}function x(t,n){for(var e=0;e<t.length;e++)if(t[e]===n)return void t.splice(e,1)}function S(){l.apply(this)}function T(t,n){for(var e in t)t.hasOwnProperty(e)&&n.call(this,e)}function w(t,n,e){if(void 0===n)return w(t,[],[]);if(t instanceof Object){for(var r=0;r<n.length;r++)if(n[r]===t)return e[r];var i;return i=t instanceof Array?[]:{},n.push(t),e.push(i),T(t,(function(r){i[r]=w(t[r],n,e)})),i}return t}l.prototype._exec=function(){for(;this._ready&&this._queue.length;){var t=this._queue.shift();t[0].apply(this,t[1])}},l.prototype._push=function(t,n){this._queue.push([t,n]),l.prototype._exec.apply(this)},l.prototype._slip=function(t,n){this._queue.unshift([t,n])},l.prototype._pause=function(){this._ready=!1},l.prototype._resume=function(){this._ready=!0,l.prototype._exec.apply(this)},l.prototype._break=function(t){this._orig._bad=!0,this._orig._log.push(t||"Unknown JZZ error")},l.prototype._repair=function(){this._orig._bad=!1},l.prototype._crash=function(t){this._break(t),this._resume()},l.prototype._err=function(){return this._log[this._log.length-1]},l.prototype.log=function(){return w(this._log)},l.prototype._dup=function(){var t=function(){};t.prototype=this._orig;var n=new t;return n._ready=!1,n._queue=[],n},l.prototype._image=function(){return this._dup()},l.prototype._thenable=function(){if(this.then)return this;var t=this,n=function(){};n.prototype=t;var e=new n;return e.then=function(n,e){return t._push(d,[n,e]),this},e},l.prototype.wait=function(t){if(!t)return this;var n=this._image();return this._push(m,[n,t]),n._thenable()},l.prototype.and=function(t){return this._push(v,[t]),this._thenable()},l.prototype.or=function(t){return this._push(y,[t]),this._thenable()},l.prototype._info={},l.prototype.info=function(){var t=w(this._orig._info);return void 0===t.engine&&(t.engine="none"),void 0===t.sysex&&(t.sysex=!0),t},l.prototype.name=function(){return this.info().name},l.prototype.close=function(){var t=new l;return this._close&&this._push(this._close,[]),this._push(b,[t]),t._thenable()},S.prototype=new l,S.prototype._info={name:"JZZ.js",ver:s,version:s,inputs:[],outputs:[]};var I,A=[],B=[],P=[],F=[],E={},O={};function N(){var t,e;for(I._info.engine=rt._type,I._info.version=rt._version,I._info.sysex=rt._sysex,I._info.inputs=[],I._info.outputs=[],A=[],B=[],rt._allOuts={},rt._allIns={},t=0;t<rt._outs.length;t++)e=rt._outs[t],E[e.name]||(e.engine=rt,rt._allOuts[e.name]=e,I._info.outputs.push({id:e.name,name:e.name,manufacturer:e.manufacturer,version:e.version,engine:rt._type}),A.push(e));for(t=0;t<it._outs.length;t++)e=it._outs[t],E[e.name]||(I._info.outputs.push({id:e.name,name:e.name,manufacturer:e.manufacturer,version:e.version,engine:e.type}),A.push(e));for(t=0;t<rt._ins.length;t++)e=rt._ins[t],O[e.name]||(e.engine=rt,rt._allIns[e.name]=e,I._info.inputs.push({id:e.name,name:e.name,manufacturer:e.manufacturer,version:e.version,engine:rt._type}),B.push(e));for(t=0;t<it._ins.length;t++)e=it._ins[t],O[e.name]||(I._info.inputs.push({id:e.name,name:e.name,manufacturer:e.manufacturer,version:e.version,engine:e.type}),B.push(e));if(I._watcher&&I._watcher._handles.length){var r=function(t,n,e,r){if(!function(t,n,e,r){var i;if(t.length!=e.length||n.length!=r.length)return!0;for(i=0;i<t.length;i++)if(t[i].name!=e[i].name)return!0;for(i=0;i<n.length;i++)if(n[i].name!=r[i].name)return!0;return!1}(t,n,e,r))return;var i,o=[],s=[],u=[],a=[],c={};for(i=0;i<t.length;i++)c[t[i].name]=!0;for(i=0;i<e.length;i++)c[e[i].name]||o.push(e[i]);for(c={},i=0;i<e.length;i++)c[e[i].name]=!0;for(i=0;i<t.length;i++)c[t[i].name]||u.push(t[i]);for(c={},i=0;i<n.length;i++)c[n[i].name]=!0;for(i=0;i<r.length;i++)c[r[i].name]||s.push(r[i]);for(c={},i=0;i<r.length;i++)c[r[i].name]=!0;for(i=0;i<n.length;i++)c[n[i].name]||a.push(n[i]);return{inputs:{added:o,removed:u},outputs:{added:s,removed:a}}}(F,P,I._info.inputs,I._info.outputs);if(r){for(n=0;n<r.inputs.removed.length;n++)(e=rt._inMap[r.inputs.removed[n].name])&&e._closeAll();for(n=0;n<r.outputs.removed.length;n++)(e=rt._outMap[r.outputs.removed[n].name])&&e._closeAll();tt(r)}}F=I._info.inputs,P=I._info.outputs}function k(){this._bad||rt._refresh(this)}function R(t,n){var e,r;p(t)&&(t=t(n)),t instanceof Array||(t=[t]);var i=[],o=[],s=n.slice(),u=i;for(e=0;e<t.length;e++)if(void 0===t[e])u=o;else if(t[e]instanceof RegExp)for(r=0;r<s.length;r++)t[e].test(s[r].name)&&(u.push(s[r]),s.splice(r,1),r--);else for(r=0;r<s.length;r++)(t[e]+""==r+""||t[e]===s[r].name||t[e]instanceof Object&&t[e].name===s[r].name)&&(u.push(s[r]),s.splice(r,1),r--);return u==i?i:i.concat(s).concat(o)}function D(t,n){var e;e=n instanceof RegExp?"Port matching "+n+" not found":n instanceof Object||void 0===n?"Port not found":'Port "'+n+'" not found',t._crash(e)}function L(t,n){if(this._bad)t._crash(this._err());else{var e=R(n,A);if(!e.length)return void D(t,n);for(var r=function(t){return function(){t.engine._openOut(this,t.name)}},i=0;i<e.length;i++)e[i]=r(e[i]);t._slip(C,[e]),t._resume()}}function q(t,n){if(this._bad)t._crash(this._err());else{var e=R(n,B);if(!e.length)return void D(t,n);for(var r=function(t){return function(){t.engine._openIn(this,t.name)}},i=0;i<e.length;i++)e[i]=r(e[i]);t._slip(C,[e]),t._resume()}}function G(t,n){this._bad?t._crash():(t._slip(Y,[n]),t._resume())}function j(){l.apply(this),this._handles=[],this._outs=[]}function z(t){this._bad||this._receive(t)}function U(t){return t.isMidi2?new bn(t):St.apply(null,arguments)}function V(t){this._emit(t)}function W(t){p(t)?M(this._orig._handles,t):M(this._orig._outs,t)}function Z(t){void 0===t?(this._orig._handles=[],this._orig._outs=[]):p(t)?x(this._orig._handles,t):x(this._orig._outs,t)}function J(t,n){this._orig._mpe||(this._orig._mpe=new yn),this._orig._mpe.setup(t,n)}function X(t){if(t!=parseInt(t)||t<0||t>15)throw RangeError("Bad channel value (must not be less than 0 or more than 15): "+t)}function H(t){l.apply(this),this._sink=t}function Q(t){return t.isMidi&&!t.isMidi2?new St(t):bn.apply(null,arguments)}function K(){l.apply(this),this._handles=[],_(this,I,"refresh"),_(this,I,"openMidiOut"),_(this,I,"openMidiIn"),_(this,I,"onChange"),_(this,I,"close")}function Y(t){p(t)&&(this._orig._handles.length||rt._watch(),M(this._orig._handles,t))}function $(t){void 0===t?this._orig._handles=[]:x(this._orig._handles,t),this._orig._handles.length||rt._unwatch()}function tt(n){for(t=0;t<I._watcher._handles.length;t++)I._watcher._handles[t].apply(I,[n])}S.prototype.refresh=function(){return this._push(k,[]),this._thenable()},S.prototype.openMidiOut=function(t){var n=new j;return this._push(k,[]),this._push(L,[n,t]),n._thenable()},S.prototype._openMidiOutNR=function(t){var n=new j;return this._push(L,[n,t]),n._thenable()},S.prototype.openMidiIn=function(t){var n=new j;return this._push(k,[]),this._push(q,[n,t]),n._thenable()},S.prototype._openMidiInNR=function(t){var n=new j;return this._push(q,[n,t]),n._thenable()},S.prototype.onChange=function(t){this._orig._watcher||(this._orig._watcher=new K);var n=this._orig._watcher._image();return this._push(G,[n,t]),n._thenable()},S.prototype._close=function(){rt._close()},j.prototype=new l,j.prototype._filter=function(t){if(this._orig._mpe){var n,e=0;this._handles&&this._handles.length&&(e=this._handles.length,n=this._handles[0]),this._outs&&this._outs.length&&(e=this._outs.length,n=this._outs[0]),1!=e||n._mpe||(t=this._orig._mpe.filter(t))}return t},j.prototype._receive=function(t){this._emit(this._filter(t))},j.prototype.send=function(){return this._push(z,[U.apply(null,arguments)]),this._thenable()},j.prototype.note=function(t,n,e,r){return this.noteOn(t,n,e),void 0===this._ch&&void 0===this._master?r>0&&this.wait(r).noteOff(t,n):e>0&&this.wait(e).noteOff(t),this._thenable()},j.prototype._emit=function(t){var n,e;for(n=0;n<this._handles.length;n++)e=U(t),this._handles[n].apply(this,[e._stamp(this)]);for(n=0;n<this._outs.length;n++)(e=U(t))._stamped(this._outs[n])||this._outs[n].send(e._stamp(this))},j.prototype.emit=function(t){return this._push(V,[t]),this._thenable()},j.prototype.connect=function(t){return this._push(W,[t]),this._thenable()},j.prototype.disconnect=function(t){return this._push(Z,[t]),this._thenable()},j.prototype.connected=function(){return this._orig._handles.length+this._orig._outs.length},j.prototype._image=function(){var t=this._dup();return t._gr=this._gr,t._ch=this._ch,t._sxid=this._sxid,t._master=this._master,t._band=this._band,t},j.prototype._sxid=127,j.prototype.sxId=function(t){if(void 0===t&&(t=j.prototype._sxid),t==this._sxid)return this._thenable();t=Ot(t);var n=this._image();return n._sxid=t,this._push(g,[n]),n._thenable()},j.prototype.ch=function(t){if(t==this._ch||void 0===t&&void 0===this._ch)return this._thenable();var n=this._image();return void 0!==t&&(t=Ft(t)),n._ch=t,n._master=void 0,n._band=void 0,this._push(g,[n]),n._thenable()},j.prototype.MIDI1=function(){var t=this._image();return t._ch=void 0,t._sxid=j.prototype._sxid,t._master=void 0,t._band=void 0,this._push(g,[t]),t._thenable()},j.prototype.MIDI2=function(){var t=this._image();t._ch=void 0,t._sxid=j.prototype._sxid,t._master=void 0,t._band=void 0;var n=new H(t);return this._push(g,[n]),n._thenable()},j.prototype.mpe=function(t,n){if(t==this._master&&n==this._band||void 0===t&&void 0===this._master)return this._thenable();if(void 0!==t&&yn.validate(t,n),!n)return this.ch(t);var e=this._image();return e._ch=void 0,e._master=t,e._band=n,this._push(J,[t,n]),this._push(g,[e]),e._thenable()},H.prototype=new l,H.prototype._sxid=j.prototype._sxid,H.prototype._receive=function(t){this._sink._receive(t)},H.prototype.send=function(){return this._push(z,[Q.apply(null,arguments)]),this._thenable()},H.prototype._image=j.prototype._image,H.prototype.connect=function(t){return this._sink.connect(t),this._push(g,[this._sink]),this._thenable()},H.prototype.disconnect=function(t){return this._sink.disconnect(t),this._push(g,[this._sink]),this._thenable()},H.prototype.connected=function(){return this._sink.connected()},H.prototype.sxId=j.prototype.sxId,H.prototype.ch=j.prototype.ch,H.prototype.gr=function(t){if(t==this._gr||void 0===t&&void 0===this._gr)return this._thenable();var n=this._image();return void 0!==t&&(t=Ot(t)),n._gr=t,this._push(g,[n]),n._thenable()},H.prototype.MIDI1=function(){var t=this._sink._image();return this._push(g,[t]),t._thenable()},H.prototype.MIDI2=function(){var t=this._image();return t._gr=void 0,t._ch=void 0,t._sxid=j.prototype._sxid,this._push(g,[t]),t._thenable()},K.prototype=new l,K.prototype.connect=function(t){return this._push(Y,[t]),this._thenable()},K.prototype.disconnect=function(t){return this._push($,[t]),this._thenable()};var nt,et,rt={_outs:[],_ins:[]},it={_outs:[],_ins:[]};function ot(){if("undefined"!=typeof module&&module.exports){var t=require("jazz-midi");if(t)return n=t,rt._type="node",rt._main=n,rt._pool=[],rt._newPlugin=function(){return new n.MIDI},void dt()}var n;this._break()}function st(){var t=document.createElement("div");t.style.visibility="hidden",document.body.appendChild(t);var n=document.createElement("object");n.style.visibility="hidden",n.style.width="0px",n.style.height="0px",n.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",n.type="audio/x-jazz",document.body.appendChild(n),n.isJazz?function(t){rt._type="plugin",rt._main=t,rt._pool=[t],rt._newPlugin=function(){var n=document.createElement("object");return n.style.visibility="hidden",n.style.width="0px",t.style.height="0px",n.classid="CLSID:1ACE1618-1C7D-4561-AEE1-34842AA85E90",n.type="audio/x-jazz",document.body.appendChild(n),n.isJazz?n:void 0},dt()}(n):this._break()}function ut(){if("undefined"!=typeof navigator&&navigator.requestMIDIAccess){nt=navigator,et=navigator.requestMIDIAccess;try{-1!=et.toString().indexOf("JZZ(")&&(et=void 0)}catch(t){}}}function at(){if(ut(),et){var t=this;return et.call(nt,{}).then((function(n){mt(n),t._resume()}),(function(n){t._crash(n)})),void this._pause()}this._break()}function ct(){if(ut(),et){var t=this;return et.call(nt,{sysex:!0}).then((function(n){mt(n,!0),t._resume()}),(function(n){t._crash(n)})),void this._pause()}this._break()}function ht(){var t,n,e=this;this._pause();try{document.addEventListener("jazz-midi-msg",(function r(i){t=!0;var o=i.detail;if(!o){if(n||(n=document.getElementById("jazz-midi-msg")),!n)return;try{o=JSON.parse(n.innerText)}catch(t){}n.innerText=""}document.removeEventListener("jazz-midi-msg",r),"version"===o[0]?(function(t,n){function e(){for(var t=0;t<this.clients.length;t++)this._close(this.clients[t])}var r;rt._type="extension",rt._version=n,rt._sysex=!0,rt._pool=[],rt._outs=[],rt._ins=[],rt._inArr=[],rt._outArr=[],rt._inMap={},rt._outMap={},rt._outsW=[],rt._insW=[],rt.refreshClients=[],rt._msg=t,rt._newPlugin=function(){var t={id:rt._pool.length};rt._pool.push(t),t.id?document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["new"]})):t.ready=!0},rt._newPlugin(),rt._refresh=function(t){rt.refreshClients.push(t),t._pause(),h((function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["refresh"]}))}))},rt._openOut=function(t,n){var r=rt._outMap[n];if(!r){rt._pool.length<=rt._outArr.length&&rt._newPlugin();var i=rt._pool[rt._outArr.length];r={name:n,clients:[],info:{name:n,manufacturer:rt._allOuts[n].manufacturer,version:rt._allOuts[n].version,type:"MIDI-out",sysex:rt._sysex,engine:rt._type},_start:function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["openout",i.id,n]}))},_close:function(t){rt._closeOut(t)},_closeAll:e,_receive:function(t){if(t.length){var n=t.slice();n.splice(0,0,"play",i.id),document.dispatchEvent(new CustomEvent("jazz-midi",{detail:n}))}}},r.plugin=i,i.output=r,rt._outArr.push(r),rt._outMap[n]=r}t._orig._impl=r,M(r.clients,t._orig),t._info=r.info,t._receive=function(t){r._receive(t)},t._close=function(){r._close(this)},r.open||(t._pause(),r.plugin.ready&&r._start())},rt._openIn=function(t,n){var r=rt._inMap[n];if(!r){rt._pool.length<=rt._inArr.length&&rt._newPlugin();var i=rt._pool[rt._inArr.length];r={name:n,clients:[],info:{name:n,manufacturer:rt._allIns[n].manufacturer,version:rt._allIns[n].version,type:"MIDI-in",sysex:rt._sysex,engine:rt._type},_start:function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["openin",i.id,n]}))},_close:function(t){rt._closeIn(t)},_closeAll:e},r.plugin=i,i.input=r,rt._inArr.push(r),rt._inMap[n]=r}t._orig._impl=r,M(r.clients,t._orig),t._info=r.info,t._close=function(){r._close(this)},r.open||(t._pause(),r.plugin.ready&&r._start())},rt._closeOut=function(t){var n=t._impl;x(n.clients,t._orig),!n.clients.length&&n.open&&(n.open=!1,document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["closeout",n.plugin.id]})))},rt._closeIn=function(t){var n=t._impl;x(n.clients,t._orig),!n.clients.length&&n.open&&(n.open=!1,document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["closein",n.plugin.id]})))},rt._close=function(){rt._unwatch()},rt._watch=function(){rt._insW=rt._ins,rt._outsW=rt._outs,r=setInterval((function(){document.dispatchEvent(new CustomEvent("jazz-midi",{detail:["refresh"]}))}),250)},rt._unwatch=function(){clearInterval(r),r=void 0},document.addEventListener("jazz-midi-msg",(function(t){var n,e,r,i=t.detail?[t.detail]:void 0;if(!i)for(i=rt._msg.innerText.split("\n"),rt._msg.innerText="",n=0;n<i.length;n++)try{i[n]=JSON.parse(i[n])}catch(t){i[n]=[]}for(n=0;n<i.length;n++){var o=i[n];if(o.length)if("refresh"===o[0]){if(o[1].ins){for(e=0;e<o[1].ins.length;e++)o[1].ins[e].type=rt._type;rt._ins=o[1].ins}if(o[1].outs){for(e=0;e<o[1].outs.length;e++)o[1].outs[e].type=rt._type;rt._outs=o[1].outs}for(N(),e=0;e<rt.refreshClients.length;e++)rt.refreshClients[e]._resume();rt.refreshClients=[]}else if("version"===o[0]){var s=rt._pool[o[1]];s&&(s.ready=!0,s.input&&s.input._start(),s.output&&s.output._start())}else if("openout"===o[0]){if(r=rt._pool[o[1]].output)if(o[2]==r.name){if(r.open=!0,r.clients)for(e=0;e<r.clients.length;e++)r.clients[e]._resume()}else if(r.clients)for(e=0;e<r.clients.length;e++)r.clients[e]._crash()}else if("openin"===o[0]){if(r=rt._pool[o[1]].input)if(o[2]==r.name){if(r.open=!0,r.clients)for(e=0;e<r.clients.length;e++)r.clients[e]._resume()}else if(r.clients)for(e=0;e<r.clients.length;e++)r.clients[e]._crash()}else if("midi"===o[0]&&(r=rt._pool[o[1]].input)&&r.clients)for(e=0;e<r.clients.length;e++){var u=St(o.slice(3));r.clients[e]._emit(u)}}}))}(n,o[2]),e._resume()):e._crash()})),document.dispatchEvent(new Event("jazz-midi"))}catch(t){}setTimeout((function(){t||e._crash()}),50)}function ft(){this._pause();var t=this;h((function(){t._crash()}))}function pt(t){for(var n=[],e=function(t){var n=["node","extension","plugin","webmidi"];if(!t||!t.engine)return n;var e,r,i,o=t.engine instanceof Array?t.engine:[t.engine],s={},u=[],a=[];for(i=0;i<o.length;i++){var c=o[i].toString().toLowerCase();s[c]||(s[c]=!0,"none"===c&&(e=!0),"etc"!==c&&void 0!==c||(r=!0),r?a.push(c):u.push(c),x(n,c))}(r||u.length||a.length)&&(e=!1);return e?[]:u.concat(r?n:a)}(t),r=0;r<e.length;r++)"webmidi"==e[r]?(t&&!0===t.sysex&&n.push(ct),t&&!0===t.sysex&&!0!==t.degrade||n.push(at)):"node"==e[r]?(n.push(ot),n.push(ft)):"extension"==e[r]?n.push(ht):"plugin"==e[r]&&n.push(st);return n.push(lt),n}function lt(){rt._type="none",rt._version=s,rt._sysex=!0,rt._outs=[],rt._ins=[],rt._refresh=function(){N()},rt._watch=f,rt._unwatch=f,rt._close=f}function dt(){var t;function n(){for(var t=0;t<this.clients.length;t++)this._close(this.clients[t])}rt._inArr=[],rt._outArr=[],rt._inMap={},rt._outMap={},rt._outsW=[],rt._insW=[],rt._version=rt._main.version,rt._sysex=!0,rt._refresh=function(){var t,n;for(rt._outs=[],rt._ins=[],t=0;(n=rt._main.MidiOutInfo(t)).length;t++)rt._outs.push({type:rt._type,name:n[0],manufacturer:n[1],version:n[2]});for(t=0;(n=rt._main.MidiInInfo(t)).length;t++)rt._ins.push({type:rt._type,name:n[0],manufacturer:n[1],version:n[2]});N()},rt._openOut=function(t,e){var r=rt._outMap[e];if(!r){rt._pool.length<=rt._outArr.length&&rt._pool.push(rt._newPlugin()),r={name:e,clients:[],info:{name:e,manufacturer:rt._allOuts[e].manufacturer,version:rt._allOuts[e].version,type:"MIDI-out",sysex:rt._sysex,engine:rt._type},_close:function(t){rt._closeOut(t)},_closeAll:n,_receive:function(t){t.length&&this.plugin.MidiOutRaw(t.slice())}};var i=rt._pool[rt._outArr.length];r.plugin=i,rt._outArr.push(r),rt._outMap[e]=r}if(!r.open){var o=r.plugin.MidiOutOpen(e);if(o!==e)return o&&r.plugin.MidiOutClose(),void t._break();r.open=!0}t._orig._impl=r,M(r.clients,t._orig),t._info=r.info,t._receive=function(t){r._receive(t)},t._close=function(){r._close(this)}},rt._openIn=function(t,e){var r,i=rt._inMap[e];if(!i){rt._pool.length<=rt._inArr.length&&rt._pool.push(rt._newPlugin()),i={name:e,clients:[],info:{name:e,manufacturer:rt._allIns[e].manufacturer,version:rt._allIns[e].version,type:"MIDI-in",sysex:rt._sysex,engine:rt._type},_close:function(t){rt._closeIn(t)},_closeAll:n,handle:function(t,n){for(var e=0;e<this.clients.length;e++){var r=St(n);this.clients[e]._emit(r)}}};i.onmidi=(r=i,function(t,n){r.handle(t,n)});var o=rt._pool[rt._inArr.length];i.plugin=o,rt._inArr.push(i),rt._inMap[e]=i}if(!i.open){var s=i.plugin.MidiInOpen(e,i.onmidi);if(s!==e)return s&&i.plugin.MidiInClose(),void t._break();i.open=!0}t._orig._impl=i,M(i.clients,t._orig),t._info=i.info,t._close=function(){i._close(this)}},rt._closeOut=function(t){var n=t._impl;x(n.clients,t._orig),!n.clients.length&&n.open&&(n.open=!1,n.plugin.MidiOutClose())},rt._closeIn=function(t){var n=t._impl;x(n.clients,t._orig),!n.clients.length&&n.open&&(n.open=!1,n.plugin.MidiInClose())},rt._close=function(){for(var t=0;t<rt._inArr.length;t++)rt._inArr[t].open&&rt._inArr[t].plugin.MidiInClose();rt._unwatch()},rt._watch=function(){t||(t=setInterval((function(){rt._refresh()}),250))},rt._unwatch=function(){t&&clearInterval(t),t=void 0}}function mt(t,n){var e;function r(){for(var t=0;t<this.clients.length;t++)this._close(this.clients[t])}rt._type="webmidi",rt._version=43,rt._sysex=!!n,rt._access=t,rt._inMap={},rt._outMap={},rt._outsW=[],rt._insW=[],rt._refresh=function(){rt._outs=[],rt._ins=[],rt._access.outputs.forEach((function(t){rt._outs.push({type:rt._type,name:t.name,manufacturer:t.manufacturer,version:t.version})})),rt._access.inputs.forEach((function(t){rt._ins.push({type:rt._type,name:t.name,manufacturer:t.manufacturer,version:t.version})})),N()},rt._openOut=function(t,n){var e,i=rt._outMap[n];i||(i={name:n,clients:[],info:{name:n,manufacturer:rt._allOuts[n].manufacturer,version:rt._allOuts[n].version,type:"MIDI-out",sysex:rt._sysex,engine:rt._type},_close:function(t){rt._closeOut(t)},_closeAll:r,_receive:function(t){i.dev&&t.length&&this.dev.send(t.slice())}}),rt._access.outputs.forEach((function(t){t.name===n&&(e=t)})),e?(i.dev=e,rt._outMap[n]=i,t._orig._impl=i,M(i.clients,t._orig),t._info=i.info,t._receive=function(t){i._receive(t)},t._close=function(){i._close(this)},i.dev.open&&(t._pause(),i.dev.open().then((function(){t._resume()}),(function(){t._crash()})))):t._break()},rt._openIn=function(t,n){var e,i,o=rt._inMap[n];if(o||(o={name:n,clients:[],info:{name:n,manufacturer:rt._allIns[n].manufacturer,version:rt._allIns[n].version,type:"MIDI-in",sysex:rt._sysex,engine:rt._type},_close:function(t){rt._closeIn(t)},_closeAll:r,handle:function(t){for(var n=0;n<this.clients.length;n++){var e=St([].slice.call(t.data));this.clients[n]._emit(e)}}}),rt._access.inputs.forEach((function(t){t.name===n&&(e=t)})),e){o.dev=e;o.dev.onmidimessage=(i=o,function(t){i.handle(t)}),rt._inMap[n]=o,t._orig._impl=o,M(o.clients,t._orig),t._info=o.info,t._close=function(){o._close(this)},o.dev.open&&(t._pause(),o.dev.open().then((function(){t._resume()}),(function(){t._crash()})))}else t._break()},rt._closeOut=function(t){var n=t._impl;x(n.clients,t._orig),n.clients.length||(n.dev&&n.dev.close&&n.dev.close(),n.dev=void 0)},rt._closeIn=function(t){var n=t._impl;x(n.clients,t._orig),n.clients.length||(n.dev&&(n.dev.onmidimessage=null,n.dev.close&&n.dev.close()),n.dev=void 0)},rt._close=function(){rt._unwatch()},rt._watch=function(){rt._access.onstatechange=function(){e=!0,h((function(){e&&(rt._refresh(),e=!1)}))}},rt._unwatch=function(){rt._access.onstatechange=void 0}}var gt=function(t){return I||function(t){(I=new S)._options=t,I._push(C,[pt(t)]),I.refresh(),I._resume()}(t),I._thenable()};function _t(){var t=this instanceof _t?this:t=new _t;return _t.prototype.reset.apply(t,arguments),t}function vt(){29.97==this.type&&!this.second&&this.frame<2&&this.minute%10&&(this.frame=2)}function yt(t){return[[24,25,29.97,30][t[7]>>1&3],(1&t[7])<<4|t[6],t[5]<<4|t[4],t[3]<<4|t[2],t[1]<<4|t[0]]}function bt(t){var n;switch(!t.backwards&&t.quarter>=4?t.decrFrame():t.backwards&&t.quarter<4&&t.incrFrame(),t.quarter>>1){case 0:n=t.frame;break;case 1:n=t.second;break;case 2:n=t.minute;break;default:n=t.hour}return 1&t.quarter?n>>=4:n&=15,7==t.quarter&&(25==t.type?n|=2:29.97==t.type?n|=4:30==t.type&&(n|=6)),!t.backwards&&t.quarter>=4?t.incrFrame():t.backwards&&t.quarter<4&&t.decrFrame(),n|t.quarter<<4}function Ct(t){return 25==t.type?32|t.hour:29.97==t.type?64|t.hour:30==t.type?96|t.hour:t.hour}function Mt(t){return t<10?"0"+t:t}function xt(t){for(var n=[],e=0;e<t.length;e++)n[e]=Mt(e?t[e]:31&t[e]);return n.join(":")}function St(t){var n,e=this instanceof St?this:e=new St;if(t instanceof St)return e._from=t._from.slice(),T(t,(function(n){"_from"!=n&&(e[n]=t[n])})),e;if(e._from=[],void 0===t)return e;var r=t instanceof Array?t:arguments;for(n=0;n<r.length;n++)i=r[n],1==n&&(e[0]>=128&&e[0]<=175&&(i=St.noteValue(i)),e[0]>=192&&e[0]<=207&&(i=St.programValue(i))),(i!=parseInt(i)||i<0||i>255)&&Bt(r[n]),e.push(i);return e}gt.JZZ=gt,gt.version=s,gt.info=function(){return S.prototype.info()},gt.Widget=function(t){var n=new j;return t instanceof Object&&T(t,(function(e){n[e]=t[e]})),n._resume(),n},S.prototype.Widget=gt.Widget,gt.addMidiIn=function(t,n){var e=w(n._info||{});e.name=t,e.type=e.type||"javascript",e.manufacturer=e.manufacturer||"virtual",e.version=e.version||"0.0";var r={_info:function(){return e},_openIn:function(t){t._pause(),t._info=w(e),t._close=function(){n.disconnect(t)},n.connect(t),t._resume()}};return gt.lib.registerMidiIn(t,r)},S.prototype.addMidiIn=gt.addMidiIn,gt.addMidiOut=function(t,n){var e=w(n._info||{});e.name=t,e.type=e.type||"javascript",e.manufacturer=e.manufacturer||"virtual",e.version=e.version||"0.0";var r={_info:function(){return e},_openOut:function(t){t._pause(),t._info=w(e),t._close=function(){t.disconnect()},W.apply(t,[n]),t._resume()}};return gt.lib.registerMidiOut(t,r)},S.prototype.addMidiOut=gt.addMidiOut,gt.maskMidiIn=function(t){O[t]=!0},S.prototype.maskMidiIn=gt.maskMidiIn,gt.unmaskMidiIn=function(t){delete O[t]},S.prototype.unmaskMidiIn=gt.unmaskMidiIn,gt.maskMidiOut=function(t){E[t]=!0},S.prototype.maskMidiOut=gt.maskMidiOut,gt.unmaskMidiOut=function(t){delete E[t]},S.prototype.unmaskMidiOut=gt.unmaskMidiOut,_t.prototype.reset=function(t){if(t instanceof _t)return this.setType(t.getType()),this.setHour(t.getHour()),this.setMinute(t.getMinute()),this.setSecond(t.getSecond()),this.setFrame(t.getFrame()),this.setQuarter(t.getQuarter()),this;var n=t instanceof Array?t:arguments;return this.setType(n[0]),this.setHour(n[1]),this.setMinute(n[2]),this.setSecond(n[3]),this.setFrame(n[4]),this.setQuarter(n[5]),this},_t.prototype.isFullFrame=function(){return 0==this.quarter||4==this.quarter},_t.prototype.getType=function(){return this.type},_t.prototype.getHour=function(){return this.hour},_t.prototype.getMinute=function(){return this.minute},_t.prototype.getSecond=function(){return this.second},_t.prototype.getFrame=function(){return this.frame},_t.prototype.getQuarter=function(){return this.quarter},_t.prototype.setType=function(t){if(void 0===t||24==t)this.type=24;else if(25==t)this.type=25;else if(29.97==t)this.type=29.97,vt.apply(this);else{if(30!=t)throw RangeError("Bad SMPTE frame rate: "+t);this.type=30}return this.frame>=this.type&&(this.frame=this.type-1),this},_t.prototype.setHour=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=24)throw RangeError("Bad SMPTE hours value: "+t);return this.hour=t,this},_t.prototype.setMinute=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=60)throw RangeError("Bad SMPTE minutes value: "+t);return this.minute=t,vt.apply(this),this},_t.prototype.setSecond=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=60)throw RangeError("Bad SMPTE seconds value: "+t);return this.second=t,vt.apply(this),this},_t.prototype.setFrame=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=this.type)throw RangeError("Bad SMPTE frame number: "+t);return this.frame=t,vt.apply(this),this},_t.prototype.setQuarter=function(t){if(void 0===t&&(t=0),t!=parseInt(t)||t<0||t>=8)throw RangeError("Bad SMPTE quarter frame: "+t);return this.quarter=t,this},_t.prototype.incrFrame=function(){return this.frame++,this.frame>=this.type&&(this.frame=0,this.second++,this.second>=60&&(this.second=0,this.minute++,this.minute>=60&&(this.minute=0,this.hour=this.hour>=23?0:this.hour+1))),vt.apply(this),this},_t.prototype.decrFrame=function(){return!this.second&&2==this.frame&&29.97==this.type&&this.minute%10&&(this.frame=0),this.frame--,this.frame<0&&(this.frame=29.97==this.type?29:this.type-1,this.second--,this.second<0&&(this.second=59,this.minute--,this.minute<0&&(this.minute=59,this.hour=this.hour?this.hour-1:23))),this},_t.prototype.incrQF=function(){return this.backwards=!1,this.quarter=this.quarter+1&7,0!=this.quarter&&4!=this.quarter||this.incrFrame(),this},_t.prototype.decrQF=function(){return this.backwards=!0,this.quarter=this.quarter+7&7,3!=this.quarter&&7!=this.quarter||this.decrFrame(),this},_t.prototype.read=function(t){if(t instanceof St||(t=St.apply(null,arguments)),240==t[0]&&127==t[1]&&1==t[3]&&1==t[4]&&247==t[9])return this.type=[24,25,29.97,30][t[5]>>5&3],this.hour=31&t[5],this.minute=t[6],this.second=t[7],this.frame=t[8],this.quarter=0,this._=void 0,this._b=void 0,this._f=void 0,!0;if(241==t[0]&&void 0!==t[1]){var n=t[1]>>4,e=15&t[1];return 0==n?7==this._&&(7==this._f&&(this.reset(yt(this._a)),this.incrFrame()),this.incrFrame()):3==n?4==this._&&this.decrFrame():4==n?3==this._&&this.incrFrame():7==n&&0===this._&&(0===this._b&&(this.reset(yt(this._a)),this.decrFrame()),this.decrFrame()),this._a||(this._a=[]),this._a[n]=e,this._f=this._f===n-1||0==n?n:void 0,this._b=this._b===n+1||7==n?n:void 0,this._=n,this.quarter=n,!0}return!1},_t.prototype.toString=function(){return xt([this.hour,this.minute,this.second,this.frame])},gt.SMPTE=_t,S.prototype.SMPTE=_t,St.prototype=[],St.prototype.constructor=St,St.prototype.isMidi=function(){return 1};var Tt={};function wt(t){if(t!=parseFloat(t))throw TypeError("Not a number: "+t)}function It(){}St.noteValue=function(t){return void 0===t?void 0:Tt[t.toString().toLowerCase()]},St.programValue=function(t){return t},St.octaveValue=function(t){var n=Tt[t.toString().toLowerCase()];return void 0===n&&(n=Tt[t.toString().toLowerCase()+"1"]),void 0===n?void 0:n%12},St.freq=function(t,n){return void 0===n&&(n=440),wt(n),t!=parseFloat(t)&&(t=Dt(t)),n*Math.pow(2,(t-69)/12)},St.shift=function(t,n){return void 0===n&&(n=440),wt(t),wt(n),12*Math.log2(t/n)},St.midi=function(t,n){return t!=parseFloat(t)?Dt(t):St.shift(t,n)+69},St.to7b=function(t){return wt(t),t<=0?0:t>=1?127:Math.floor(128*t)},St.to14b=function(t){return wt(t),t<=0?0:t>=1?16383:Math.floor(16384*t)},St.to21b=function(t){return void 0===t?2097151:(wt(t),t<=0?0:(t=(Math.floor(t)<<14)+St.to14b(t-Math.floor(t)))<2097151?t:2097150)},St.to32b=function(t){return wt(t),t<=0?0:t>=1?4294967295:Math.floor(4294967296*t)},It.prototype=St,St._sxid=127,St.sxId=function(t){if(void 0===t&&(t=St._sxid),t==this._sxid)return this;t=Ot(t);var n=new It;return n._ch=this._ch,n._sxid=t,n},St.ch=function(t){if(t==this._ch||void 0===t&&void 0===this._ch)return this;var n=new It;return void 0!==t&&(t=Ft(t)),n._ch=t,n._sxid=this._sxid,n};var At={c:0,d:2,e:4,f:5,g:7,a:9,b:11,h:11};for(T(At,(function(t){for(i=0;i<12&&!((r=At[t]+12*i)>127);i++)Tt[t+i]=r,Tt[t+"♮"+i]=r,r>0&&(Tt[t+"b"+i]=r-1,Tt[t+"♭"+i]=r-1,Tt[t+"bb"+i]=r-2,Tt[t+"♭♭"+i]=r-2,Tt[t+"𝄫"+i]=r-2),r<127&&(Tt[t+"#"+i]=r+1,Tt[t+"♯"+i]=r+1,Tt[t+"##"+i]=r+2,Tt[t+"♯♯"+i]=r+2,Tt[t+"𝄪"+i]=r+2)})),i=0;i<128;i++)Tt[i]=i;function Bt(t){throw RangeError("Bad MIDI value: "+t)}function Pt(t){throw TypeError("Invalid value: "+t)}function Ft(t){return X(t),parseInt(t)}function Et(t){if(t!=parseInt(t)||t<0||t>15)throw RangeError("Expected a 4-bit value: "+t);return parseInt(t)}function Ot(t,n){return(t!=parseInt(t)||t<0||t>127)&&Bt(void 0===n?t:n),parseInt(t)}function Nt(t){return(t!=parseInt(t)||t<0||t>255)&&Bt(t),parseInt(t)}function kt(t){return(t!=parseInt(t)||t<0||t>16383)&&Bt(t),parseInt(t)}function Rt(t){if(t!=parseInt(t)||t<0||t>65535)throw RangeError("Expected a 16-bit value: "+t);return parseInt(t)}function Dt(t){return Ot(St.noteValue(t),t)}function Lt(t){return 127&kt(t)}function qt(t){return kt(t)>>7}function Gt(t){return[t>>14,t>>7&127,127&t]}function jt(t,n){return t!=parseFloat(t)&&Pt(void 0===n?t:n),(t<0||t>1)&&function(t){throw RangeError("Out of range: "+t)}(void 0===n?t:n),parseFloat(t)}function zt(t){return void 0===t||t?127:126}function Ut(t){var n,e,r=[],i={};T(t,(function(n){if(e=function(t){return(t!=parseInt(t)||t<0||t>2097151)&&Bt(t),parseInt(t)}(t[n]),(n=Dt(n))in i)throw RangeError("Duplicate MIDI value: "+n);r.push(n),i[n]=e})),r.sort();var o=[r.length];for(n=0;n<r.length;n++)o=o.concat([r[n]],Gt(i[r[n]]));return o}function Vt(t){var n={};return T(t,(function(e){n[e]=St.to21b(t[e]==parseFloat(t[e])?t[e]:Dt(t[e]))})),n}function Wt(t){var n={};return T(t,(function(e){n[e]=St.to21b(St.midi(t[e]))})),n}var Zt={noteOff:function(t,n,e){return void 0===e&&(e=64),[128+Ft(t),Dt(n),Ot(e)]},noteOn:function(t,n,e){return void 0===e&&(e=127),[144+Ft(t),Dt(n),Ot(e)]},aftertouch:function(t,n,e){return[160+Ft(t),Dt(n),Ot(e)]}},Jt={control:function(t,n,e){return[176+Ft(t),Ot(n),Ot(e)]},program:function(t,n){return[192+Ft(t),Ot(St.programValue(n),n)]},pressure:function(t,n){return[208+Ft(t),Ot(n)]},pitchBend:function(t,n,e){return void 0===e?[224+Ft(t),Lt(n),qt(n)]:[224+Ft(t),Ot(e),Ot(n)]},pitchBendF:function(t,n){return Jt.pitchBend(t,St.to14b((n+1)/2))},bankMSB:function(t,n){return[176+Ft(t),0,Ot(n)]},bankLSB:function(t,n){return[176+Ft(t),32,Ot(n)]},modMSB:function(t,n){return[176+Ft(t),1,Ot(n)]},modLSB:function(t,n){return[176+Ft(t),33,Ot(n)]},breathMSB:function(t,n){return[176+Ft(t),2,Ot(n)]},breathLSB:function(t,n){return[176+Ft(t),34,Ot(n)]},footMSB:function(t,n){return[176+Ft(t),4,Ot(n)]},footLSB:function(t,n){return[176+Ft(t),36,Ot(n)]},portamentoMSB:function(t,n){return[176+Ft(t),5,Ot(n)]},portamentoLSB:function(t,n){return[176+Ft(t),37,Ot(n)]},dataMSB:function(t,n){return[176+Ft(t),6,Ot(n)]},dataLSB:function(t,n){return[176+Ft(t),38,Ot(n)]},volumeMSB:function(t,n){return[176+Ft(t),7,Ot(n)]},volumeLSB:function(t,n){return[176+Ft(t),39,Ot(n)]},balanceMSB:function(t,n){return[176+Ft(t),8,Ot(n)]},balanceLSB:function(t,n){return[176+Ft(t),40,Ot(n)]},panMSB:function(t,n){return[176+Ft(t),10,Ot(n)]},panLSB:function(t,n){return[176+Ft(t),42,Ot(n)]},expressionMSB:function(t,n){return[176+Ft(t),11,Ot(n)]},expressionLSB:function(t,n){return[176+Ft(t),43,Ot(n)]},damper:function(t,n){return void 0===n&&(n=!0),[176+Ft(t),64,n?127:0]},portamento:function(t,n){return void 0===n&&(n=!0),[176+Ft(t),65,n?127:0]},sostenuto:function(t,n){return void 0===n&&(n=!0),[176+Ft(t),66,n?127:0]},soft:function(t,n){return void 0===n&&(n=!0),[176+Ft(t),67,n?127:0]},legato:function(t,n){return void 0===n&&(n=!0),[176+Ft(t),68,n?127:0]},hold2:function(t,n){return void 0===n&&(n=!0),[176+Ft(t),69,n?127:0]},soundVariation:function(t,n){return[176+Ft(t),70,Dt(n)]},filterResonance:function(t,n){return[176+Ft(t),71,Dt(n)]},releaseTime:function(t,n){return[176+Ft(t),72,Dt(n)]},attackTime:function(t,n){return[176+Ft(t),73,Dt(n)]},brightness:function(t,n){return[176+Ft(t),74,Dt(n)]},decayTime:function(t,n){return[176+Ft(t),75,Dt(n)]},vibratoRate:function(t,n){return[176+Ft(t),76,Dt(n)]},vibratoDepth:function(t,n){return[176+Ft(t),77,Dt(n)]},vibratoDelay:function(t,n){return[176+Ft(t),78,Dt(n)]},ptc:function(t,n){return[176+Ft(t),84,Dt(n)]},dataIncr:function(t){return[176+Ft(t),96,0]},dataDecr:function(t){return[176+Ft(t),97,0]},nrpnLSB:function(t,n){return[176+Ft(t),98,Ot(n)]},nrpnMSB:function(t,n){return[176+Ft(t),99,Ot(n)]},rpnLSB:function(t,n){return[176+Ft(t),100,Ot(n)]},rpnMSB:function(t,n){return[176+Ft(t),101,Ot(n)]},allSoundOff:function(t){return[176+Ft(t),120,0]},resetAllControllers:function(t){return[176+Ft(t),121,0]},localControl:function(t,n){return void 0===n&&(n=!0),[176+Ft(t),122,n?127:0]},allNotesOff:function(t){return[176+Ft(t),123,0]},omni:function(t,n){return void 0===n&&(n=!0),[176+Ft(t),n?125:124,0]},mono:function(t,n){return void 0===n&&(n=1),[176+Ft(t),126,Ot(n)]},poly:function(t){return[176+Ft(t),127,0]}};function Xt(t,n,e,r){return void 0!==n?[Ot(t),Ot(n),Ot(e),Ot(r)]:((t!=parseInt(t)||t<0||t>65535)&&Pt(t),[(t=parseInt(t))>>12&15,t>>8&15,t>>4&15,15&t])}function Ht(t){return wt(t),(t=Math.round(65536*t+16384))<0?0:t>65535?65535:t}var Qt={mtc:function(t){return[241,bt(t)]},songPosition:function(t,n){return void 0===n?[242,Lt(t),qt(t)]:[242,Ot(n),Ot(t)]},songSelect:function(t){return[243,Ot(t)]},tune:function(){return[246]},clock:function(){return[248]},start:function(){return[250]},continue:function(){return[251]},stop:function(){return[252]},active:function(){return[254]},reset:function(){return[255]}},Kt={sxIdRequest:function(){return[240,126,this._sxid,6,1,247]},sxTuningDumpRequest:function(t,n){return void 0===n?[240,126,this._sxid,8,0,Ot(t),247]:[240,126,this._sxid,8,3,Ot(t),Ot(n),247]},sxFullFrame:function(t){return[240,127,this._sxid,1,1,Ct(t),t.getMinute(),t.getSecond(),t.getFrame(),247]},sxMasterVolume:function(t,n){return void 0===n?[240,127,this._sxid,4,1,Lt(t),qt(t),247]:[240,127,this._sxid,4,1,Ot(n),Ot(t),247]},sxMasterVolumeF:function(t){return Kt.sxMasterVolume.call(this,St.to14b(jt(t)))},sxMasterFineTuning:function(t,n){return void 0===n?[240,127,this._sxid,4,3,Lt(t),qt(t),247]:[240,127,this._sxid,4,3,Ot(n),Ot(t),247]},sxMasterFineTuningF:function(t){return Kt.sxMasterFineTuning.call(this,St.to14b(jt((t%1+1)/2,t)))},sxMasterCoarseTuning:function(t){return[240,127,this._sxid,4,4,0,Ot(t),247]},sxMasterCoarseTuningF:function(t){return Kt.sxMasterCoarseTuning.call(this,t-t%1+64)},sxNoteTuning:function(t,n,e,r){return n==parseInt(n)?[240,zt(r),this._sxid,8,7,Ot(t),Ot(n)].concat(Ut(e),[247]):[240,127,this._sxid,8,2,Ot(t)].concat(Ut(n),[247])},sxNoteTuningF:function(t,n,e,r){return n==parseInt(n)?Kt.sxNoteTuning.call(this,t,n,Vt(e),r):Kt.sxNoteTuning.call(this,t,Vt(n))},sxNoteTuningHZ:function(t,n,e,r){return n==parseInt(n)?Kt.sxNoteTuning.call(this,t,n,Wt(e),r):Kt.sxNoteTuning.call(this,t,Wt(n))},sxScaleTuning1:function(t,n,e){return t==parseInt(t)?[240,zt(e),this._sxid,8,8].concat(Gt(Rt(t)),function(t){var n=[];if(!(t instanceof Array)||12!=t.length)throw TypeError("Expected an array of size 12");for(var e=0;e<12;e++)n.push(Ot(t[e]));return n}(n),[247]):Kt.sxScaleTuning1.call(this,65535,t,n)},sxScaleTuning1F:function(t,n,e){if(t!=parseInt(t))return Kt.sxScaleTuning1F.call(this,65535,t,n);for(var r=[],i=0;i<n.length;i++){if(n[i]<-.64||n[i]>.63)throw RangeError("Out of range: "+n[i]);r.push(Math.floor(100*n[i]+64))}return Kt.sxScaleTuning1.call(this,t,r,e)},sxScaleTuning2:function(t,n,e){return t==parseInt(t)?[240,zt(e),this._sxid,8,9].concat(Gt(Rt(t)),function(t){var n=[];if(!(t instanceof Array)||12!=t.length)throw TypeError("Expected an array of size 12");for(var e=0;e<12;e++)n.push(qt(t[e])),n.push(Lt(t[e]));return n}(n),[247]):Kt.sxScaleTuning2.call(this,65535,t,n)},sxScaleTuning2F:function(t,n,e){if(t!=parseInt(t))return Kt.sxScaleTuning2F.call(this,65535,t,n);for(var r=[],i=0;i<n.length;i++){var o=(n[i]+1)/2;if(o<-1||o>1)throw RangeError("Out of range: "+n[i]);r.push(St.to14b((n[i]+1)/2))}return Kt.sxScaleTuning2.call(this,t,r,e)},sxGM:function(t){return void 0===t&&(t=1),[240,126,this._sxid,9,t?2==t?3:1:2,247]},sxGS:function(t){for(var n=void 0===t?[64,0,127,0]:t instanceof Array?t:arguments,e=0,r=[240,65,this._sxid,66,18],i=0;i<n.length;i++){var o=Ot(n[i]);r.push(o),e+=o}return e%=128,r.push(e?128-e:0),r.push(247),r},sxXG:function(t){var n=void 0===t?[0,0,126,0]:t instanceof Array?t:arguments,e=127==this._sxid?0:this._sxid;e>15&&Bt("Bad Yamaha device number: "+e);for(var r=[240,67,16+e,76],i=0;i<n.length;i++)r.push(Ot(n[i]));return r.push(247),r},sxMidiSoft:function(t,n){var e=[240,0,32,36,0,Ot(t||0)];n=void 0===n?"":""+n;for(var r=0;r<n.length;r++)e.push(Ot(n.charCodeAt(r)));return e.push(247),e},gsMasterVolume:function(t){return Kt.sxGS.call(this,[64,0,4,Ot(t)])},gsMasterVolumeF:function(t){return Kt.gsMasterVolume.call(this,St.to7b(jt(t)))},gsMasterFineTuning:function(t,n,e,r){return t=Xt(t,n,e,r),Kt.sxGS.call(this,[64,0,0,t[0],t[1],t[2],t[3]])},gsMasterFineTuningF:function(t){return Kt.gsMasterFineTuning.call(this,Ht(t%1))},gsMasterCoarseTuning:function(t){return Kt.sxGS.call(this,[64,0,5,Ot(t)])},gsMasterCoarseTuningF:function(t){return Kt.gsMasterCoarseTuning.call(this,t-t%1+64)},gsOctaveTuning:function(t,n,e){return Kt.sxGS.call(this,[64,16+[1,2,3,4,5,6,7,8,9,0,11,12,13,14,15][Ft(t)],64+St.octaveValue(n),Ot(e)])},gsOctaveTuningF:function(t,n,e){if(e<-.64||e>.63)throw RangeError("Out of range: "+e);return Kt.gsOctaveTuning.call(this,t,n,Math.floor(100*e+64))},xgMasterVolume:function(t){return Kt.sxXG.call(this,[0,0,4,Ot(t)])},xgMasterVolumeF:function(t){return Kt.xgMasterVolume.call(this,St.to7b(jt(t)))},xgMasterFineTuning:function(t,n,e,r){return t=Xt(t,n,e,r),Kt.sxXG.call(this,[0,0,0,t[0],t[1],t[2],t[3]])},xgMasterFineTuningF:function(t){return Kt.xgMasterFineTuning.call(this,Ht(t%1))},xgMasterCoarseTuning:function(t){return Kt.sxXG.call(this,[0,0,6,Ot(t)])},xgMasterCoarseTuningF:function(t){return Kt.xgMasterCoarseTuning.call(this,t-t%1+64)},xgOctaveTuning:function(t,n,e){return Kt.sxXG.call(this,[8,Ft(t),65+St.octaveValue(n),Ot(e)])},xgOctaveTuningF:function(t,n,e){if(e<-.64||e>.63)throw RangeError("Out of range: "+e);return Kt.xgOctaveTuning.call(this,t,n,Math.floor(100*e+64))}};Kt.sxScaleTuning=Kt.sxScaleTuning2,Kt.sxScaleTuningF=Kt.sxScaleTuning2F,Kt.sxMasterTranspose=Kt.sxMasterCoarseTuning,Kt.sxMasterTransposeF=Kt.sxMasterCoarseTuningF,Kt.gsMasterTranspose=Kt.gsMasterCoarseTuning,Kt.gsMasterTransposeF=Kt.gsMasterCoarseTuningF,Kt.xgMasterTranspose=Kt.xgMasterCoarseTuning,Kt.xgMasterTransposeF=Kt.xgMasterCoarseTuningF;var Yt={bank:function(t,n,e){return void 0===e?[Jt.bankMSB(t,qt(n)),Jt.bankLSB(t,Lt(n))]:[Jt.bankMSB(t,n),Jt.bankLSB(t,e)]},modF:function(t,n){return Yt.mod(t,St.to14b(n))},mod:function(t,n,e){return void 0===e?[Jt.modMSB(t,qt(n)),Jt.modLSB(t,Lt(n))]:[Jt.modMSB(t,n),Jt.modLSB(t,e)]},breathF:function(t,n){return Yt.breath(t,St.to14b(n))},breath:function(t,n,e){return void 0===e?[Jt.breathMSB(t,qt(n)),Jt.breathLSB(t,Lt(n))]:[Jt.breathMSB(t,n),Jt.breathLSB(t,e)]},footF:function(t,n){return Yt.foot(t,St.to14b(n))},foot:function(t,n,e){return void 0===e?[Jt.footMSB(t,qt(n)),Jt.footLSB(t,Lt(n))]:[Jt.footMSB(t,n),Jt.footLSB(t,e)]},portamentoTimeF:function(t,n){return Yt.portamentoTime(t,St.to14b(n))},portamentoTime:function(t,n,e){return void 0===e?[Jt.portamentoMSB(t,qt(n)),Jt.portamentoLSB(t,Lt(n))]:[Jt.portamentoMSB(t,n),Jt.portamentoLSB(t,e)]},dataF:function(t,n){return Yt.data(t,St.to14b(n))},data:function(t,n,e){return void 0===e?[Jt.dataMSB(t,qt(n)),Jt.dataLSB(t,Lt(n))]:[Jt.dataMSB(t,n),Jt.dataLSB(t,e)]},volumeF:function(t,n){return Yt.volume(t,St.to14b(n))},volume:function(t,n,e){return void 0===e?[Jt.volumeMSB(t,qt(n)),Jt.volumeLSB(t,Lt(n))]:[Jt.volumeMSB(t,n),Jt.volumeLSB(t,e)]},balanceF:function(t,n){return Yt.balance(t,St.to14b((n+1)/2))},balance:function(t,n,e){return void 0===e?[Jt.balanceMSB(t,qt(n)),Jt.balanceLSB(t,Lt(n))]:[Jt.balanceMSB(t,n),Jt.balanceLSB(t,e)]},panF:function(t,n){return Yt.pan(t,St.to14b((n+1)/2))},pan:function(t,n,e){return void 0===e?[Jt.panMSB(t,qt(n)),Jt.panLSB(t,Lt(n))]:[Jt.panMSB(t,n),Jt.panLSB(t,e)]},expressionF:function(t,n){return Yt.expression(t,St.to14b(n))},expression:function(t,n,e){return void 0===e?[Jt.expressionMSB(t,qt(n)),Jt.expressionLSB(t,Lt(n))]:[Jt.expressionMSB(t,n),Jt.expressionLSB(t,e)]},nrpn:function(t,n,e){return void 0===e?[Jt.nrpnMSB(t,qt(n)),Jt.nrpnLSB(t,Lt(n))]:[Jt.nrpnMSB(t,n),Jt.nrpnLSB(t,e)]},rpn:function(t,n,e){return void 0===e?[Jt.rpnMSB(t,qt(n)),Jt.rpnLSB(t,Lt(n))]:[Jt.rpnMSB(t,n),Jt.rpnLSB(t,e)]},rpnPitchBendRange:function(t,n,e){return Yt.rpn(t,0,0).concat(Yt.data(t,n,e))},rpnPitchBendRangeF:function(t,n){return Yt.rpnPitchBendRange(t,Ot(n-n%1),Math.floor(n%1*100))},rpnFineTuning:function(t,n,e){return Yt.rpn(t,0,1).concat(Yt.data(t,n,e))},rpnFineTuningF:function(t,n){return Yt.rpn(t,0,1).concat(Yt.dataF(t,(n%1+1)/2))},rpnCoarseTuning:function(t,n){return Yt.rpn(t,0,2).concat([Jt.dataMSB(t,n)])},rpnCoarseTuningF:function(t,n){return Yt.rpn(t,0,2).concat([Jt.dataMSB(t,n-n%1+64)])},rpnTuning:function(t,n,e,r){return Yt.rpnCoarseTuning(t,n).concat(Yt.rpnFineTuning(t,e,r))},rpnTuningF:function(t,n){return Yt.rpnCoarseTuningF(t,n).concat(Yt.rpnFineTuningF(t,n))},rpnTuningA:function(t,n){return Yt.rpnTuningF(t,St.shift(n))},rpnSelectTuningProgram:function(t,n){return Yt.rpn(t,0,3).concat([Jt.dataMSB(t,n)])},rpnSelectTuningBank:function(t,n){return Yt.rpn(t,0,4).concat([Jt.dataMSB(t,n)])},rpnSelectTuning:function(t,n,e){return void 0===e?Yt.rpnSelectTuningProgram(t,n):Yt.rpnSelectTuningBank(t,n).concat(Yt.rpnSelectTuningProgram(t,e))},rpnModulationDepthRange:function(t,n,e){return Yt.rpn(t,0,5).concat(Yt.data(t,n,e))},rpnModulationDepthRangeF:function(t,n){return Yt.rpnModulationDepthRange(t,Ot(n-n%1),Math.floor(n%1*128))},rpnNull:function(t){return Yt.rpn(t,127,127)},mode1:function(t){return[Jt.omni(t,!0),Jt.poly(t)]},mode2:function(t){return[Jt.omni(t,!0),Jt.mono(t)]},mode3:function(t){return[Jt.omni(t,!1),Jt.poly(t)]},mode4:function(t){return[Jt.omni(t,!1),Jt.mono(t)]}};Yt.rpnTranspose=Yt.rpnCoarseTuningF;var $t={sxMasterTuning:function(t,n,e){return[Kt.sxMasterCoarseTuning.call(this,t),Kt.sxMasterFineTuning.call(this,n,e)]},sxMasterTuningF:function(t){return[Kt.sxMasterCoarseTuningF.call(this,t),Kt.sxMasterFineTuningF.call(this,t)]},gsMasterTuningF:function(t){return[Kt.gsMasterCoarseTuningF.call(this,t),Kt.gsMasterFineTuningF.call(this,t)]},xgMasterTuningF:function(t){return[Kt.xgMasterCoarseTuningF.call(this,t),Kt.xgMasterFineTuningF.call(this,t)]},sxMasterTuningA:function(t){return $t.sxMasterTuningF.call(this,St.shift(t))},gsMasterTuningA:function(t){return $t.gsMasterTuningF.call(this,St.shift(t))},xgMasterTuningA:function(t){return $t.xgMasterTuningF.call(this,St.shift(t))},gsScaleTuning:function(t,n){var e=[];if(12!=n.length)throw RangeError("Wrong input size: "+n.length);for(var r=0;r<12;r++)e.push(Kt.gsOctaveTuning.call(this,t,r,n[r]));return e},gsScaleTuningF:function(t,n){var e=[];if(12!=n.length)throw RangeError("Wrong input size: "+n.length);for(var r=0;r<12;r++)e.push(Kt.gsOctaveTuningF.call(this,t,r,n[r]));return e},xgScaleTuning:function(t,n){var e=[];if(12!=n.length)throw RangeError("Wrong input size: "+n.length);for(var r=0;r<12;r++)e.push(Kt.xgOctaveTuning.call(this,t,r,n[r]));return e},xgScaleTuningF:function(t,n){var e=[];if(12!=n.length)throw RangeError("Wrong input size: "+n.length);for(var r=0;r<12;r++)e.push(Kt.xgOctaveTuningF.call(this,t,r,n[r]));return e}};function tn(t,n){var e=new St;return e.ff=Nt(t),e.dd=void 0===n?"":function(t){t=""+t;for(var n=0;n<t.length;n++)t.charCodeAt(n)>255&&Bt(t[n]);return t}(n),e}var nn={smf:function(t){if(t instanceof St)return new St(t);var n=t instanceof Array?t:arguments,e=Nt(n[0]),r="";return 2==n.length?r=an(n[1]):n.length>2&&(r=an(Array.prototype.slice.call(n,1))),tn(e,r)},smfSeqNumber:function(t){if(t==parseInt(t)){if(t<0||t>65535)throw RangeError("Sequence number out of range: "+t);t=String.fromCharCode(t>>8)+String.fromCharCode(255&t)}else if(0==(t=""+t).length)t="\0\0";else if(1==t.length)t="\0"+t;else if(t.length>2)throw RangeError("Sequence number out of range"+dn(t));return tn(0,t)},smfText:function(t){return tn(1,gt.lib.toUTF8(t))},smfCopyright:function(t){return tn(2,gt.lib.toUTF8(t))},smfSeqName:function(t){return tn(3,gt.lib.toUTF8(t))},smfInstrName:function(t){return tn(4,gt.lib.toUTF8(t))},smfLyric:function(t){return tn(5,gt.lib.toUTF8(t))},smfMarker:function(t){return tn(6,gt.lib.toUTF8(t))},smfCuePoint:function(t){return tn(7,gt.lib.toUTF8(t))},smfProgName:function(t){return tn(8,gt.lib.toUTF8(t))},smfDevName:function(t){return tn(9,gt.lib.toUTF8(t))},smfChannelPrefix:function(t){if(t==parseInt(t))X(t),t=String.fromCharCode(t);else if(0==(t=""+t).length)t="\0";else if(t.length>1||t.charCodeAt(0)>15)throw RangeError("Channel number out of range"+dn(t));return tn(32,t)},smfMidiPort:function(t){if(t==parseInt(t)){if(t<0||t>127)throw RangeError("Port number out of range: "+t);t=String.fromCharCode(t)}else if(0==(t=""+t).length)t="\0";else if(t.length>1||t.charCodeAt(0)>127)throw RangeError("Port number out of range"+dn(t));return tn(33,t)},smfEndOfTrack:function(t){if(""!=an(t))throw RangeError("Unexpected data"+dn(an(t)));return tn(47)},smfTempo:function(t){if(3==(""+t).length)return tn(81,t);if(t==parseInt(t)&&t>0&&t<=16777215)return tn(81,String.fromCharCode(t>>16)+String.fromCharCode(t>>8&255)+String.fromCharCode(255&t));throw RangeError("Out of range"+dn(an(t)))},smfBPM:function(t){return nn.smfTempo(Math.round(6e7/t))},smfSMPTE:function(t){if(t instanceof _t)return tn(84,String.fromCharCode(t.hour)+String.fromCharCode(t.minute)+String.fromCharCode(t.second)+String.fromCharCode(t.frame)+String.fromCharCode(t.quarter%4*25));if(5==(""+t).length)return tn(84,t);var n=t instanceof Array?t:Array.prototype.slice.call(arguments);return n.splice(0,0,30),nn.smfSMPTE(new _t(n))},smfTimeSignature:function(t,n,e,r){var i,o,s,u,a=(""+t).match(/^\s*(\d+)\s*\/\s*(\d+)\s*$/);if(a){if(i=parseInt(a[1]),o=parseInt(a[2]),i>0&&i<256&&o>0&&!(o&o-1)){for(s=o,o=0,s>>=1;s;s>>=1)o++;return s=n==parseInt(n)?n:24,u=e==parseInt(e)?e:8,tn(88,String.fromCharCode(i)+String.fromCharCode(o)+String.fromCharCode(s)+String.fromCharCode(u))}if(4==(""+t).length)return tn(88,t)}else if(t==parseInt(t)&&n==parseInt(n)){if(t>0&&t<256&&n>0&&!(n&n-1)){for(i=t,o=0,s=n,s>>=1;s;s>>=1)o++;return s=e==parseInt(e)?e:24,u=r==parseInt(r)?r:8,tn(88,String.fromCharCode(i)+String.fromCharCode(o)+String.fromCharCode(s)+String.fromCharCode(u))}if(4==(""+t).length)return tn(88,t);t=t+"/"+n}else if(4==(""+t).length)return tn(88,t);throw RangeError("Wrong time signature"+dn(an(""+t)))},smfKeySignature:function(t){var n=(t=""+t).match(/^\s*([A-H][b#]?)\s*(|maj|major|dur|m|min|minor|moll)\s*$/i);if(n){var e={CB:0,GB:1,DB:2,AB:3,EB:4,BB:5,F:6,C:7,G:8,D:9,A:10,E:11,B:12,H:12,"F#":13,"C#":14,"G#":15,"D#":16,"A#":17}[n[1].toUpperCase()],r={"":0,MAJ:0,MAJOR:0,DUR:0,M:1,MIN:1,MINOR:1,MOLL:1}[n[2].toUpperCase()];void 0!==e&&void 0!==r&&(r&&(e-=3),(e-=7)>=-7&&e<0?t=String.fromCharCode(256+e)+String.fromCharCode(r):e>=0&&e<=7&&(t=String.fromCharCode(e)+String.fromCharCode(r)))}if(2==t.length&&t.charCodeAt(1)<=1&&(t.charCodeAt(0)<=7||t.charCodeAt(0)<=255&&t.charCodeAt(0)>=249))return tn(89,t);throw RangeError("Incorrect key signature"+dn(t))},smfSequencer:function(t){return tn(127,an(t))}},en={};function rn(t,n){St[t]=function(){return new St(n.apply(this,arguments))},en[t]=function(){return this.send(n.apply(this,arguments))}}function on(t){T(en,(function(n){t.prototype[n]=en[n]}))}T(Qt,(function(t){rn(t,Qt[t])})),T(Kt,(function(t){rn(t,Kt[t])})),T(nn,(function(t){var n,e;n=t,e=nn[t],St[n]=function(){return e.apply(this,arguments)},en[n]=function(){return this.send(e.apply(this,arguments))}})),T($t,(function(t){var n,e;n=t,e=$t[t],St[n]=function(){var t,n=[],r=e.apply(this,arguments);for(t=0;t<r.length;t++)n.push(new St(r[t]));return n},en[n]=function(){for(var t=e.apply(this,arguments),n=this,r=0;r<t.length;r++)n=n.send(t[r]);return n}})),T(Zt,(function(t){var n,e;e=Zt[t],St[n=t]=function(){return new St(e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))))},en[n]=function(){if(void 0!==this._master){var t=new St(e.apply(this,[this._master].concat(Array.prototype.slice.call(arguments))));return t._mpe=t[1],this.send(t)}return this.send(e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))))}})),T(Jt,(function(t){var n,e;n=t,e=Jt[t],St[n]=function(){return new St(e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))))},en[n]=function(){if(void 0!==this._master){var t,n=Array.prototype.slice.call(arguments);n.length<e.length?n=[this._master].concat(n):(t=Dt(n[0]),n[0]=this._master);var r=new St(e.apply(this,n));return r._mpe=t,this.send(r)}return this.send(e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))))}})),T(Yt,(function(t){var n,e;n=t,e=Yt[t],St[n]=function(){var t,n=[],r=e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments)));for(t=0;t<r.length;t++)n.push(new St(r[t]));return n},en[n]=function(){var t,n,r;if(void 0!==this._master){var i,o=Array.prototype.slice.call(arguments);for(o.length<e.length?o=[this._master].concat(o):(i=Dt(o[0]),o[0]=this._master),n=e.apply(this,o),r=this,t=0;t<n.length;t++){var s=St(n[t]);s._mpe=i,r=r.send(s)}return r}for(n=e.apply(this,void 0===this._ch?arguments:[this._ch].concat(Array.prototype.slice.call(arguments))),r=this,t=0;t<n.length;t++)r=r.send(n[t]);return r}})),on(j);var sn={a:10,b:11,c:12,d:13,e:14,f:15,A:10,B:11,C:12,D:13,E:14,F:15};for(e=0;e<16;e++)sn[e]=e;function un(t){for(var n=[],e=0;e<t.length;e++)n[e]=t.charCodeAt(e);return n}function an(t){return t instanceof Array?function(t){for(var n="",e=0;e<t.length;e++)n+=String.fromCharCode(t[e]);return n}(t):void 0===t?"":""+t}function cn(t){return(t<16?"0":"")+t.toString(16)}function hn(t){for(var n=[],e=0;e<t.length;e++)n.push(cn(t[e]));return n.join(" ")}function fn(t){for(var n=[],e=0;e<t.length;e++)e&&e%4==0&&n.push(" "),n.push(cn(t[e]));return n.join("")}function pn(t){for(var n="",e=0;e<t.length;e++)"\n"==t[e]?n+="\\n":"\r"==t[e]?n+="\\r":"\t"==t[e]?n+="\\t":t.charCodeAt(e)<32?n+="\\x"+cn(t.charCodeAt(e)):n+=t[e];return n}function ln(t){return t.length?": "+hn(un(t)):""}function dn(t){return t.length?": "+pn(gt.lib.fromUTF8(t)):""}function mn(t){void 0===t?this._cc={}:this._cc[t]={}}function gn(t){var n,e="";for(n=0;n<t.length&&t[n];n++)e+=String.fromCharCode(t[n]);return gt.lib.fromUTF8(e)}function _n(t){var n,e,r,i,o,s,u,a,c,h="x",f="x";if(t.isMidi2?(r=t[0]>>4,e=h=(15&t[0]).toString(16),this._cc[e]||(this._cc[e]={}),2==r?n=new St(t.slice(1)):3==r?(i=t[1]>>4,o=15&t[1],s=t.slice(2,2+o),0==i&&(n=new St([240].concat(s,[247])),this._cc[e].sx=void 0),1==i&&(this._cc[e].sx=s),2==i&&this._cc[e].sx&&(this._cc[e].sx=this._cc[e].sx.concat(s)),3==i&&this._cc[e].sx&&(s=this._cc[e].sx.concat(s),n=new St([240].concat(s,[247])),this._cc[e].sx=void 0)):4==r?(i=t[1]>>4,e=h+(f=(15&t[1]).toString(16)),this._cc[e]||(this._cc[e]={}),12==i&&(1&t[3]&&(this._cc[e].bm=t[6],this._cc[e].bl=t[7]),t._bm=this._cc[e].bm,t._bl=this._cc[e].bl,gt.MIDI.programName&&t.label(gt.MIDI.programName(t[4],t._bm,t._bl)))):13==r&&(i=t[1]>>6,48&t[1]||(f=(15&t[1]).toString(16)),e=h+f,this._cc[e]||(this._cc[e]={}),s=t.slice(4),0==i&&(t.label(gn(s)),this._cc[e].tx=void 0),1==i&&(this._cc[e].tx=s),2==i&&this._cc[e].tx&&(this._cc[e].tx=this._cc[e].tx.concat(s)),3==i&&this._cc[e].tx&&(s=this._cc[e].tx.concat(s),t.label(gn(s)),this._cc[e].tx=void 0))):n=t,!n||!n.length||n[0]<128)return t;if(255==n[0])return this._clear(),t;if(i=n[0]>>4,f=(15&n[0]).toString(16),e=15==i?h:h+f,this._cc[e]||(this._cc[e]={}),12==i)n._bm=this._cc[e].bm,n._bl=this._cc[e].bl,gt.MIDI.programName&&t.label(gt.MIDI.programName(n[1],n._bm,n._bl));else if(11==i)switch(n[1]){case 0:this._cc[e].bm=n[2];break;case 32:this._cc[e].bl=n[2];break;case 98:this._cc[e].nl=n[2],this._cc[e].rn="n";break;case 99:this._cc[e].nm=n[2],this._cc[e].rn="n";break;case 100:this._cc[e].rl=n[2],this._cc[e].rn="r";break;case 101:this._cc[e].rm=n[2],this._cc[e].rn="r";break;case 6:case 38:case 96:case 97:"r"==this._cc[e].rn&&(n._rm=this._cc[e].rm,n._rl=this._cc[e].rl,t.label(function(t,n){var e=void 0===t?"??":cn(t),r=void 0===n?"??":cn(n),i={"0000":"Pitch Bend Sensitivity","0001":"Channel Fine Tuning","0002":"Channel Coarse Tuning","0003":"Select Tuning Program","0004":"Select Tuning Bank","0005":"Vibrato Depth Range","7f7f":"NONE"}[e+""+r];return"RPN "+e+" "+r+(i?": "+i:"")}(this._cc[e].rm,this._cc[e].rl))),"n"==this._cc[e].rn&&(n._nm=this._cc[e].rm,n._nl=this._cc[e].nl,t.label((a=this._cc[e].nm,c=this._cc[e].nl,"NRPN "+(void 0===a?"??":cn(a))+" "+(void 0===c?"??":cn(c)))))}else n.isFullSysEx()&&(127==n[1]?4==n[3]?(u={1:"Master Volume",2:"Master Balance",3:"Master Fine Tuning",4:"Master Coarse Tuning"}[n[4]])&&t.label(u):8==n[3]&&(u={2:"Note Tuning",7:"Note Tuning, Bank",8:"Scale Tuning, 1 byte format",9:"Scale Tuning, 2 byte format"}[n[4]])&&t.label(u):126==n[1]?6==n[3]?1==n[4]?t.label("Device ID Request"):2==n[4]&&t.label("Device ID Response"):8==n[3]?(u={0:"Bulk Tuning Dump Request",1:"Bulk Tuning Dump",3:"Bulk Tuning Dump Request, Bank",4:"Bulk Tuning Dump, Bank",5:"Scale Tuning Dump, 1 byte format",6:"Scale Tuning Dump, 2 byte format",7:"Note Tuning, Bank",8:"Scale Tuning, 1 byte format",9:"Scale Tuning, 2 byte format"}[n[4]])&&t.label(u):9==n[3]&&(1==n[4]?(t.label("GM1 System On"),this._clear(h),this._cc[h].gm="1"):2==n[4]?(t.label("GM System Off"),this._clear(h),this._cc[h].gm="0"):3==n[4]&&(t.label("GM2 System On"),this._clear(h),this._cc[h].gm="2")):67==n[1]?16==(240&n[2])&&76==n[3]&&(0==n[4]&&0==n[5]&&126==n[6]&&0==n[7]?(t.label("XG System On"),this._clear(h),this._cc[h].gm="Y"):0==n[4]&&0==n[5]&&0==n[6]?t.label("XG Master Tuning"):0==n[4]&&0==n[5]&&4==n[6]?t.label("XG Master Volume"):0==n[4]&&0==n[5]&&6==n[6]?t.label("XG Master Transpose"):8==n[4]&&n[5]<16&&n[6]>=65&&n[6]<=76?t.label("XG Scale Tuning"):t.label("XG Parameter")):65==n[1]&&66==n[3]&&18==n[4]&&(64==n[5]&&(0==n[6]?127==n[7]&&0==n[8]&&65==n[9]?(t.label("GS Reset"),this._clear(h),this._cc[h].gm="R"):0==n[7]?t.label("GS Master Tuning"):4==n[7]?t.label("GS Master Volume"):5==n[7]?t.label("GS Master Transpose"):t.label("GS Parameter"):16==(240&n[6])&&21==n[7]?t.label("GS Drum Part Change"):16==(240&n[6])&&n[7]>=64&&n[7]<=75?t.label("GS Scale Tuning"):t.label("GS Parameter")),65==n[5]&&t.label("GS Parameter")));return t}function vn(){var t=new j;return t._clear=mn,t._read=_n,t._receive=function(t){this._emit(this._read(t))},t.gm=function(t){return void 0===t&&(t="x"),this._cc[t]&&this._cc[t].gm||0},t._clear(),t._resume(),t}function yn(){var t=this instanceof yn?this:t=new yn;return t.reset(),arguments.length&&yn.prototype.setup.apply(t,arguments),t}function bn(t){var n,e=this instanceof bn?this:e=new bn;if(t instanceof bn)return e._from=t._from.slice(),T(t,(function(n){"_from"!=n&&(e[n]=t[n])})),e;e._from=[],void 0===t&&(t=[0,0,0,0]);var r=t instanceof Array?t:arguments;for(e.length=0,n=0;n<r.length;n++)((i=r[n])!=parseInt(i)||i<0||i>255)&&Bt(r[n]),e.push(i);if(e.length!=[4,4,4,8,8,16,4,4,8,8,8,12,12,16,16,16][e[0]>>4])throw RangeError("Wrong UMP size");return e}function Cn(){}St.prototype.getChannel=function(){if(32==this.ff&&1==this.dd.length&&this.dd.charCodeAt(0)<16)return this.dd.charCodeAt(0);var t=this[0];return void 0===t||t<128||t>239?void 0:15&t},St.prototype.setChannel=function(t){if(void 0===(t=sn[t]))return this;if(32==this.ff)this.dd=String.fromCharCode(t);else{var n=this[0];void 0!==n&&n>=128&&n<=239&&(this[0]=240&n|t)}return this},St.prototype.getNote=function(){var t=this[0];if(!(void 0===t||t<128||t>175))return this[1]},St.prototype.setNote=function(t){var n=this[0];return void 0===n||n<128||n>175||void 0!==(t=St.noteValue(t))&&(this[1]=t),this},St.prototype.getVelocity=function(){var t=this[0];if(!(void 0===t||t<128||t>159))return this[2]},St.prototype.setVelocity=function(t){var n=this[0];return void 0===n||n<128||n>159||(t=parseInt(t))>=0&&t<128&&(this[2]=t),this},St.prototype.getSysExId=function(){if(240==this[0])return this[2]},St.prototype.setSysExId=function(t){return 240==this[0]&&this.length>2&&(t=parseInt(t))>=0&&t<128&&(this[2]=t),this},St.prototype.getData=function(){if(void 0!==this.dd)return this.dd.toString()},St.prototype.setData=function(t){return this.dd=an(t),this},St.prototype.getText=function(){if(void 0!==this.dd)return t=this.ff,n=this.dd,function(t,n){return 127==t&&void 0!==n&&67==n.charCodeAt(0)&&123==n.charCodeAt(1)}(t,n)&&1==n.charCodeAt(2)?function(t,n){if(t>=0&&t<=127&&n>=0&&n<=127){var e=15&t,r=t>>4;return e>0&&e<8&&r<7?(e=["C","D","E","F","G","A","B"][e-1]+["bbb","bb","b","","#","##","###"][r],n>34?e+"?":e+["","6","Maj7","Maj7(#11)","(9)","Maj7(9)","6(9)","aug","m","m6","m7","m7b5","m(9)","m7(9)","m7(11)","m+7","m+7(9)","dim","dim7","7","7sus4","7b5","7(9)","7(#11)","7(13)","7(b9)","7(b13)","7(#9)","Maj7aug","7aug","1+8","1+5","sus4","1+2+5","cc"][n]):"-"}return"-"}(this.dd.charCodeAt(3),this.dd.charCodeAt(4)):gt.lib.fromUTF8(this.dd);var t,n;if(this.isMidiSoft()){for(var e=[],r=6;r<this.length-1;r++)e.push(String.fromCharCode(this[r]));return e.join("")}},St.prototype.setText=function(t){return this.dd=gt.lib.toUTF8(t),this},St.prototype.getTempo=function(){if(81==this.ff&&void 0!==this.dd)return 65536*this.dd.charCodeAt(0)+256*this.dd.charCodeAt(1)+this.dd.charCodeAt(2)},St.prototype.getBPM=function(){var t=this.getTempo();if(t)return 6e7/t},St.prototype.getTimeSignature=function(){if(88==this.ff&&void 0!==this.dd)return[this.dd.charCodeAt(0),1<<this.dd.charCodeAt(1)]},St.prototype.getTimeSignature4=function(){if(88==this.ff&&void 0!==this.dd){var t=[this.dd.charCodeAt(0),1<<this.dd.charCodeAt(1)];return 4==this.dd.length&&t.push(this.dd.charCodeAt(2),this.dd.charCodeAt(3)),t}},St.prototype.getKeySignature=function(){if(89==this.ff&&void 0!==this.dd){var t=this.dd.charCodeAt(0),n=this.dd.charCodeAt(1);if(128&t&&(t-=256),t>=-7&&t<=7&&n>=0&&n<=1)return[t,["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#","G#","D#","A#"][n?t+10:t+7],!!n]}},St.prototype.isNoteOn=function(){var t=this[0];return!(void 0===t||t<144||t>159)&&this[2]>0},St.prototype.isNoteOff=function(){var t=this[0];return!(void 0===t||t<128||t>159)&&(t<144||0==this[2])},St.prototype.isSysEx=function(){return 240==this[0]},St.prototype.isFullSysEx=function(){return 240==this[0]&&247==this[this.length-1]},St.prototype.isMidiSoft=function(){return this.isFullSysEx()&&0==this[1]&&32==this[2]&&36==this[3]&&0==this[4]},St.prototype.isSMF=function(){return this.ff>=0&&this.ff<=127},St.prototype.isEOT=function(){return 47==this.ff},St.prototype.isText=function(){return 1==this.ff},St.prototype.isCopyright=function(){return 2==this.ff},St.prototype.isSeqName=function(){return 3==this.ff},St.prototype.isInstrName=function(){return 4==this.ff},St.prototype.isLyric=function(){return 5==this.ff},St.prototype.isMarker=function(){return 6==this.ff},St.prototype.isCuePoint=function(){return 7==this.ff},St.prototype.isProgName=function(){return 8==this.ff},St.prototype.isDevName=function(){return 9==this.ff},St.prototype.isTempo=function(){return 81==this.ff},St.prototype.isTimeSignature=function(){return 88==this.ff},St.prototype.isKeySignature=function(){return 89==this.ff},St.prototype.isGmReset=function(){return this.match([240,126,[0,0],9,[0,0],247])},St.prototype.isGsReset=function(){return this.match([240,65,[0,0],66,18,64,0,127,0,65,247])},St.prototype.isXgReset=function(){return this.match([240,67,[16,240],76,0,0,126,0,247])},St.prototype.match=function(t){var n,e;for(n=0;n<t.length;n++)if(void 0===(e=t[n][1])){if(this[n]!=t[n])return!1}else if((this[n]&e)!=(t[n][0]&e))return!1;return!0},St.prototype.label=function(t){return this.lbl=this.lbl?this.lbl+", "+t:t,this},St.prototype.toString=function(){return this.lbl?this._str()+" ("+this.lbl+")":this._str()},St.prototype._str=function(){var t,n;if(this.length)t=hn(this);else{if(void 0===this.ff)return"empty";t="ff"+cn(this.ff)}return(n=this._string())?t+" -- "+n:t},St.prototype._string=function(){var t,n="";if(!this.length){if(0==this.ff)n+="Sequence Number: "+function(t){for(var n=0,e=0;e<t.length;e++)n=(n<<8)+t.charCodeAt(e);return n}(this.dd);else if(this.ff>0&&this.ff<10)n+=["","Text","Copyright","Sequence Name","Instrument Name","Lyric","Marker","Cue Point","Program Name","Device Name"][this.ff]+dn(this.dd);else if(32==this.ff)n+="Channel Prefix"+ln(this.dd);else if(33==this.ff)n+="MIDI Port"+ln(this.dd);else if(47==this.ff)n+="End of Track"+ln(this.dd);else if(81==this.ff){n+="Tempo: "+Math.round(100*this.getBPM())/100+" bpm"}else if(84==this.ff)n+="SMPTE Offset: "+xt(un(this.dd));else if(88==this.ff){var e=1<<this.dd.charCodeAt(1);n+="Time Signature: "+this.dd.charCodeAt(0)+"/"+e,n+=" "+this.dd.charCodeAt(2)+" "+this.dd.charCodeAt(3)}else if(89==this.ff){n+="Key Signature: ";var r=this.getKeySignature();r?(n+=r[1],r[2]&&(n+=" min")):n+="invalid"}else if(127==this.ff){if(67==this.dd.charCodeAt(0)&&123==this.dd.charCodeAt(1))return n+="[XF:"+cn(this.dd.charCodeAt(2))+"]",n+=(t={0:"Version",1:"Chord",2:"Rehearsal Mark",3:"Phrase Mark",4:"Max Phrase Mark",5:"Fingering Number",12:"Guide Track Flag",16:"Guitar Info",18:"Chord Voicing",127:"XG Song Data Number"}[this.dd.charCodeAt(2)])?" "+t:"",n+=": ",0==this.dd.charCodeAt(2)?n+this.dd.substr(3,4)+" "+hn(un(this.dd.substr(7))):1==this.dd.charCodeAt(2)?n+this.getText():n+hn(un(this.dd.substr(3)));n+="Sequencer Specific"+ln(this.dd)}else n+="SMF"+ln(this.dd);return n}if(t={241:"MIDI Time Code",242:"Song Position",243:"Song Select",244:"Undefined",245:"Undefined",246:"Tune request",248:"Timing clock",249:"Undefined",250:"Start",251:"Continue",252:"Stop",253:"Undefined",254:"Active Sensing",255:"Reset"}[this[0]])return t;if(this.isMidiSoft())return(t=pn(this.getText()))&&(t=" "+t),"[K:"+cn(this[5])+"]"+t;var i=this[0]>>4;return(t={8:"Note Off",10:"Aftertouch",12:"Program Change",13:"Channel Aftertouch",14:"Pitch Wheel"}[i])?t:9==i?this[2]?"Note On":"Note Off":11!=i?n:(t={0:"Bank Select MSB",1:"Modulation Wheel MSB",2:"Breath Controller MSB",4:"Foot Controller MSB",5:"Portamento Time MSB",6:"Data Entry MSB",7:"Channel Volume MSB",8:"Balance MSB",10:"Pan MSB",11:"Expression Controller MSB",12:"Effect Control 1 MSB",13:"Effect Control 2 MSB",16:"General Purpose Controller 1 MSB",17:"General Purpose Controller 2 MSB",18:"General Purpose Controller 3 MSB",19:"General Purpose Controller 4 MSB",31:"Karaoke",32:"Bank Select LSB",33:"Modulation Wheel LSB",34:"Breath Controller LSB",36:"Foot Controller LSB",37:"Portamento Time LSB",38:"Data Entry LSB",39:"Channel Volume LSB",40:"Balance LSB",42:"Pan LSB",43:"Expression Controller LSB",44:"Effect control 1 LSB",45:"Effect control 2 LSB",48:"General Purpose Controller 1 LSB",49:"General Purpose Controller 2 LSB",50:"General Purpose Controller 3 LSB",51:"General Purpose Controller 4 LSB",64:"Damper Pedal",65:"Portamento",66:"Sostenuto",67:"Soft Pedal",68:"Legato",69:"Hold 2",70:"Sound Variation",71:"Filter Resonance",72:"Release Time",73:"Attack Time",74:"Brightness",75:"Decay Time",76:"Vibrato Rate",77:"Vibrato Depth",78:"Vibrato Delay",79:"Sound Controller 10",80:"General Purpose Controller 5",81:"General Purpose Controller 6",82:"General Purpose Controller 7",83:"General Purpose Controller 8",84:"Portamento Control",88:"High Resolution Velocity Prefix",91:"Effects 1 Depth",92:"Effects 2 Depth",93:"Effects 3 Depth",94:"Effects 4 Depth",95:"Effects 5 Depth",96:"Data Increment",97:"Data Decrement",98:"Non-Registered Parameter Number LSB",99:"Non-Registered Parameter Number MSB",100:"Registered Parameter Number LSB",101:"Registered Parameter Number MSB",120:"All Sound Off",121:"Reset All Controllers",122:"Local Control On/Off",123:"All Notes Off",124:"Omni Mode Off",125:"Omni Mode On",126:"Mono Mode On",127:"Poly Mode On"}[this[1]],this[1]>=64&&this[1]<=69&&(t+=this[2]<64?" Off":" On"),t||(t="Undefined"),t)},St.prototype._stamp=function(t){return this._from.push(t._orig?t._orig:t),this},St.prototype._unstamp=function(t){if(void 0===t)this._from=[];else{t._orig&&(t=t._orig);var n=this._from.indexOf(t);n>-1&&this._from.splice(n,1)}return this},St.prototype._stamped=function(t){t._orig&&(t=t._orig);for(var n=0;n<this._from.length;n++)if(this._from[n]==t)return!0;return!1},gt.MIDI=St,S.prototype.MIDI=St,gt.Context=vn,S.prototype.Context=vn,yn.validate=function(t){var n=t instanceof Array?t:arguments;if(n[0]!=parseInt(n[0])||n[0]<0||n[0]>14)throw RangeError("Bad master channel value: "+n[0]);if(n[1]!=parseInt(n[1])||n[1]<0||n[0]+n[1]>15)throw RangeError("Bad zone size value: "+n[1])},yn.prototype.reset=function(){for(var t=0;t<16;t++)this[t]={band:0,master:t}},yn.prototype.setup=function(t,n){var e;yn.validate(t,n);var r=t+n;if((this[t].master!=t||this[t].band!=n)&&(n||this[t].band)){for(this[t].band?r<(e=t+this[t].band)&&(r=e):this[t].master==t-1?(e=t-1,r<(e+=this[e].band)&&(r=e),this[t-1]={band:0,master:t-1}):this[t].master!=t&&(e=this[t].master,r<(e+=this[e].band)&&(r=e),this[this[t].master].band=t-this[t].master-1),this[t].master=t,this[t].band=n,e=t+1;e<=t+n;e++)this[e].band&&r<e+this[e].band&&(r=e+this[e].band),this[e]={band:0,master:t};for(;e<=r;e++)this[e]={band:0,master:e}}},yn.prototype.filter=function(t){var n=t.getChannel();if(!this[n]||!this[this[n].master].band)return t;var e,r,i,o=this[n].master,s=this[o].band;if(void 0!==t._mpe){for(i=256,e=o+1;e<=o+s;e++)if(this[e].notes){for(i>this[e].notes.length&&(n=e,i=this[e].notes.length),r=0;r<this[e].notes.length;r++)if(this[e].notes[r]==t._mpe){n=e,i=-1;break}}else i>0&&(n=e,i=0);t.setChannel(n),t._mpe=void 0}return n==o||(t.isNoteOn()?(this[n].notes||(this[n].notes=[]),M(this[n].notes,t.getNote())):t.isNoteOff()&&this[n].notes&&x(this[n].notes,t.getNote())),t},gt.MPE=yn,bn.prototype=[],bn.prototype.constructor=bn,bn.prototype.isMidi=function(){return 2},bn.prototype.isMidi2=!0,bn.prototype.dump=function(){var t,n="";for(t=0;t<this.length;t++)n+=String.fromCharCode(this[t]);return n},Cn.prototype=bn,bn._sxid=127,bn.sxId=function(t){if(void 0===t&&(t=bn._sxid),t==this._sxid)return this;t=Ot(t);var n=new Cn;return n._ch=this._ch,n._gr=this._gr,n._sxid=t,n},bn.ch=function(t){if(t==this._ch||void 0===t&&void 0===this._ch)return this;var n=new Cn;return void 0!==t&&(t=Ft(t)),n._ch=t,n._gr=this._gr,n._sxid=this._sxid,n},bn.gr=function(t){if(t==this._gr||void 0===t&&void 0===this._gr)return this;var n=new Cn;return void 0!==t&&(t=Et(t)),n._ch=this._ch,n._gr=t,n._sxid=this._sxid,n},bn.prototype.getGroup=function(){if(this[0]){var t=this[0]>>4;return 1==t||2==t||3==t||4==t||5==t||13==t?15&this[0]:void 0}};var Mn=[0,0,0,0,0,0,0,0,0,0,0,0,0];function xn(t,n,e,r){return void 0!==n?[Nt(t),Nt(n),Nt(e),Nt(r)]:(t=function(t){return(t!=parseInt(t)||t<0||t>4294967295)&&Bt(t),parseInt(t)}(t),[t>>24&255,t>>16&255,t>>8&255,255&t])}function Sn(t){return(t=Math.floor(4294967296*t))>4294967295?4294967295:t<0?0:t}var Tn={noop:function(){return[0,0,0,0]},umpClock:function(t){return[0,16,(t=Rt(t))>>8,255&t]},umpTimestamp:function(t){return[0,32,(t=Rt(t))>>8,255&t]},umpTicksPQN:function(t){return[0,48,(t=Rt(t))>>8,255&t]},umpDelta:function(t){return[0,64+((t=function(t){if(t!=parseInt(t)||t<0||t>1048575)throw RangeError("Expected a 20-bit value: "+t);return parseInt(t)}(t=t||0))>>16),t>>8&255,255&t]},umpStartClip:function(){return[240,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},umpEndClip:function(){return[240,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}},wn={umpTempo:function(t,n){return[208+Et(t),16,0,0].concat(xn(n),[0,0,0,0,0,0,0,0])},umpBPM:function(t,n){return wn.umpTempo(t,Math.round(6e9/n))},umpTimeSignature:function(t,n,e){var r,i,o,s=(""+n).match(/^\s*(\d+)\s*\/\s*(\d+)\s*$/);if(s?(r=parseInt(s[1]),i=parseInt(s[2])):n==parseInt(n)&&e==parseInt(e)&&(r=parseInt(n),i=parseInt(e)),r>0&&r<256&&i>0&&!(i&i-1)){for(o=0,i>>=1;i;i>>=1)o++;if((i=Math.round(32*r/(1<<o)))<256)return[208+Et(t),16,0,1,r,o,i,0,0,0,0,0,0,0,0,0]}throw RangeError("Wrong time signature "+n+(void 0===e?"":"/"+e))}},In={umpMetadata:function(t,n){return Pn.umpCustomText(t,0,1,1,0,n)},umpProjectName:function(t,n){return Pn.umpCustomText(t,0,1,1,1,n)},umpCompositionName:function(t,n){return Pn.umpCustomText(t,0,1,1,2,n)},umpClipName:function(t,n){return Pn.umpCustomText(t,0,1,1,3,n)},umpCopyright:function(t,n){return Pn.umpCustomText(t,0,1,1,4,n)},umpComposerName:function(t,n){return Pn.umpCustomText(t,0,1,1,5,n)},umpLyricistName:function(t,n){return Pn.umpCustomText(t,0,1,1,6,n)},umpArrangerName:function(t,n){return Pn.umpCustomText(t,0,1,1,7,n)},umpPublisherName:function(t,n){return Pn.umpCustomText(t,0,1,1,8,n)},umpPerformerName:function(t,n){return Pn.umpCustomText(t,0,1,1,9,n)},umpAccPerformerName:function(t,n){return Pn.umpCustomText(t,0,1,1,10,n)},umpRecordingDate:function(t,n){return Pn.umpCustomText(t,0,1,1,11,n)},umpRecordingLocation:function(t,n){return Pn.umpCustomText(t,0,1,1,12,n)},umpText:function(t,n){return Pn.umpCustomText(t,0,1,2,0,n)},umpLyrics:function(t,n){return Pn.umpCustomText(t,0,1,2,1,n)},umpLyricsLanguage:function(t,n){return Pn.umpCustomText(t,0,1,2,2,n)},umpRuby:function(t,n){return Pn.umpCustomText(t,0,1,2,3,n)},umpRubyLanguage:function(t,n){return Pn.umpCustomText(t,0,1,2,4,n)},umpData:function(t,n,e){var r;void 0===e&&(e=n,n=0);var i=On(function(t){var n,e=[];if("string"==typeof t)for(n=0;n<t.length;n++)e.push(t.charCodeAt(n));else for(n=0;n<t.length;n++)e.push(t[n]);for(n=0;n<e.length;n++)if(e[n]!=parseInt(e[n])||e[n]<0||e[n]>255)throw RangeError("Bad data");return e}(e),13);for(r=0;r<i.length;r++)i[r]=[80+Et(t),16*En(i.length,r)+i[r].length,Nt(n)].concat(i[r],Mn).slice(0,16);return i}},An=[0,6,32,38,98,99,100,101],Bn={umpNoteOn:function(t,n,e,r,i,o){return void 0===r&&(r=65535),i=i||0,o=o||0,r=Rt(r),o=Rt(o),[64+Et(t),144+Ft(n),Dt(e),Nt(i),r>>8,255&r,o>>8,255&o]},umpNoteOff:function(t,n,e,r,i,o){return i=i||0,o=o||0,r=Rt(r=r||0),o=Rt(o),[64+Et(t),128+Ft(n),Dt(e),Nt(i),r>>8,255&r,o>>8,255&o]},umpAftertouch:function(t,n,e,r,i,o,s){return[64+Et(t),160+Ft(n),Dt(e),0].concat(xn(r,i,o,s))},umpAftertouchF:function(t,n,e,r){return Bn.umpAftertouch(t,n,e,Sn(r))},umpControl:function(t,n,e,r,i,o,s){return An.includes(e)&&Bt(e),[64+Et(t),176+Ft(n),Ot(e),0].concat(xn(r,i,o,s))},umpPortamento:function(t,n,e){return[64+Et(t),176+Ft(n),84,0,Dt(e),0,0,0]},umpPressure:function(t,n,e,r,i,o){return[64+Et(t),208+Ft(n),0,0].concat(xn(e,r,i,o))},umpPressureF:function(t,n,e){return Bn.umpPressure(t,n,Sn(e))},umpProgram:function(t,n,e,r,i){return void 0===r&&void 0===i?[64+Et(t),192+Ft(n),0,0,Dt(e),0,0,0]:[64+Et(t),192+Ft(n),0,1,Dt(e),0,Dt(r),Dt(i)]},umpPitchBend:function(t,n,e,r,i,o){return[64+Et(t),224+Ft(n),0,0].concat(xn(e,r,i,o))},umpPitchBendF:function(t,n,e){return Bn.umpPitchBend(t,n,Sn((e+1)/2))},umpPnPitchBend:function(t,n,e,r,i,o,s){return[64+Et(t),96+Ft(n),Dt(e),0].concat(xn(r,i,o,s))},umpPnPitchBendF:function(t,n,e,r){return Bn.umpPnPitchBend(t,n,e,Sn((r+1)/2))},umpRPN:function(t,n,e,r,i,o,s,u){return[64+Et(t),32+Ft(n),Ot(e),Ot(r)].concat(xn(i,o,s,u))},umpNRPN:function(t,n,e,r,i,o,s,u){return[64+Et(t),48+Ft(n),Ot(e),Ot(r)].concat(xn(i,o,s,u))},umpPnRPN:function(t,n,e,r,i,o,s,u){return[64+Et(t),0+Ft(n),Dt(e),Nt(r)].concat(xn(i,o,s,u))},umpPnNRPN:function(t,n,e,r,i,o,s,u){return[64+Et(t),16+Ft(n),Dt(e),Nt(r)].concat(xn(i,o,s,u))},umpFineTuning:function(t,n,e,r,i,o){return Bn.umpRPN(t,n,0,1,e,r,i,o)},umpFineTuningF:function(t,n,e){return Bn.umpFineTuning(t,n,St.to32b(jt((e%1+1)/2,e)))},umpCoarseTuning:function(t,n,e){return[64+Et(t),32+Ft(n),0,2,2*Ot(e),0,0,0]},umpCoarseTuningF:function(t,n,e){return Bn.umpCoarseTuning(t,n,e-e%1+64)},umpTuningProgram:function(t,n,e){return[64+Et(t),32+Ft(n),0,3,2*Ot(e),0,0,0]},umpTuningBank:function(t,n,e){return[64+Et(t),32+Ft(n),0,4,2*Ot(e),0,0,0]},umpPnManagement:function(t,n,e,r){for(var i=r.toString().split(""),o=0,s=0;s<i.length;s++)if("S"!=i[s]||1&o){if("D"!=i[s]||2&o){o=r;break}o|=2}else o|=1;return[64+Et(t),240+Ft(n),Dt(e),Nt(o),0,0,0,0]}};Bn.umpPnPressure=Bn.umpAftertouch,Bn.umpPnPressureF=Bn.umpAftertouchF,Bn.umpTranspose=Bn.umpCoarseTuningF;var Pn={umpTuningF:function(t,n,e){return[Bn.umpCoarseTuningF(t,n,e),Bn.umpFineTuningF(t,n,e)]},umpTuningA:function(t,n,e){return Pn.umpTuningF(t,n,St.shift(e))},umpCustomText:function(t,n,e,r,i,o){var s,u=[];for(o=gt.lib.toUTF8(""+o),s=0;s<o.length;s++)u.push(o.charCodeAt(s));for(u=On(u,12),s=0;s<u.length;s++)u[s]=[208+Et(t),64*En(u.length,s)+(e?16:0)+Ft(n),r,i].concat(u[s],Mn).slice(0,16);return u},umpCMetadata:function(t,n,e){return Pn.umpCustomText(t,n,0,1,0,e)},umpCProjectName:function(t,n,e){return Pn.umpCustomText(t,n,0,1,1,e)},umpCCompositionName:function(t,n,e){return Pn.umpCustomText(t,n,0,1,2,e)},umpCClipName:function(t,n,e){return Pn.umpCustomText(t,n,0,1,3,e)},umpCCopyright:function(t,n,e){return Pn.umpCustomText(t,n,0,1,4,e)},umpCComposerName:function(t,n,e){return Pn.umpCustomText(t,n,0,1,5,e)},umpCLyricistName:function(t,n,e){return Pn.umpCustomText(t,n,0,1,6,e)},umpCArrangerName:function(t,n,e){return Pn.umpCustomText(t,n,0,1,7,e)},umpCPublisherName:function(t,n,e){return Pn.umpCustomText(t,n,0,1,8,e)},umpCPerformerName:function(t,n,e){return Pn.umpCustomText(t,n,0,1,9,e)},umpCAccPerformerName:function(t,n,e){return Pn.umpCustomText(t,n,0,1,10,e)},umpCRecordingDate:function(t,n,e){return Pn.umpCustomText(t,n,0,1,11,e)},umpCRecordingLocation:function(t,n,e){return Pn.umpCustomText(t,n,0,1,12,e)},umpCText:function(t,n,e){return Pn.umpCustomText(t,n,0,2,0,e)},umpCLyrics:function(t,n,e){return Pn.umpCustomText(t,n,0,2,1,e)},umpCLyricsLanguage:function(t,n,e){return Pn.umpCustomText(t,n,0,2,2,e)},umpCRuby:function(t,n,e){return Pn.umpCustomText(t,n,0,2,3,e)},umpCRubyLanguage:function(t,n,e){return Pn.umpCustomText(t,n,0,2,4,e)}},Fn={};function En(t,n){return 1==t?0:0==n?1:n==t-1?3:2}function On(t,n){for(var e=[],r=t;r.length;r=r.slice(n))e.push(r.slice(0,n));return e.length?e:[[]]}function Nn(t,n){for(var e=On(n.slice(1,n.length-1),6),r=0;r<e.length;r++)e[r]=new bn([48+t,16*En(e.length,r)+e[r].length].concat(e[r],Mn).slice(0,8));return e}function kn(t,n){bn[t]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),void 0!==this._ch&&(t=[t[0]].concat([this._ch]).concat(t.slice(1))),new bn([32+Et(t[0])].concat(n.apply(this,t.slice(1)),Mn).slice(0,4))},Fn[t]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),void 0!==this._ch&&(t=[t[0]].concat([this._ch]).concat(t.slice(1))),this.send([32+Et(t[0])].concat(n.apply(this,t.slice(1)),Mn).slice(0,4))}}function Rn(t){T(Fn,(function(n){t.prototype[n]=Fn[n]}))}function Dn(t,n){var e=256*t+n;return e?e>>9||1:0}function Ln(t,n,e,r){return 16777216*t+65536*n+256*e+r>>25&127}function qn(t,n){return t.gr=n,t}function Gn(t){if(t.isMidi2){var n,e,r,i=t[0]>>4,o=15&t[0];if(1==i||2==i)this._emit(qn(new St(t.slice(1)),o));else if(3==i)e=t[1]>>4,n=15&t[1],0==e?(this._emit(qn(new St([240].concat(t.slice(2,2+n),[247])),o)),this._sx[o]=void 0):1==e?this._sx[o]=t.slice(2,2+n):2==e?this._sx[o]&&(this._sx[o]=this._sx[o].concat(t.slice(2,2+n))):3==e&&(this._sx[o]&&this._emit(qn(new St([240].concat(this._sx[o],t.slice(2,2+n),[247])),o)),this._sx[o]=void 0);else if(4==i){if(n=t[1]>>4,e=15&t[1],2==n||3==n?(this._emit(qn(new St([176+e,2==n?101:99,t[2]]),o)),this._emit(qn(new St([176+e,2==n?100:98,t[3]]),o)),this._emit(qn(new St([176+e,6,t[4]>>1]),o)),this._emit(qn(new St([176+e,38,64*(1&t[4])+(t[4]>>2)]),o))):8!=n&&9!=n||this._emit(qn(new St([t[1],t[2],Dn(t[4],t[5])]),o)),10==n&&this._emit(qn(new St([t[1],t[2],Ln(t[4],t[5],t[6],t[7])]),o)),11==n){if(An.includes(t[2]))return;this._emit(qn(new St([t[1],t[2],Ln(t[4],t[5],t[6],t[7])]),o))}13==n&&this._emit(qn(new St([t[1],Ln(t[4],t[5],t[6],t[7])]),o)),14==n?(r=16777216*t[4]+65536*t[5]+256*t[6]+t[4]>>18,this._emit(qn(new St([t[1],127&r,r>>7&127]),o))):12==n&&(t[3]&&(this._emit(qn(new St([176+e,0,t[6]]),o)),this._emit(qn(new St([176+e,32,t[7]]),o))),this._emit(qn(new St([t[1],t[4]]),o)))}}else this._emit(t)}function jn(t){if(t.isMidi2)this._emit(t);else{var n=t.gr>=0&&t.gr<=15?t.gr:0;if(t[0]>=128&&t[0]<240)this._emit(gt.MIDI2([32+n].concat(t.slice(),Mn).slice(0,4)));else if(t[0]>240&&t[0]<=255&&247!=t[0])this._emit(gt.MIDI2([16+n].concat(t.slice(),Mn).slice(0,4)));else if(t.isFullSysEx())for(var e=Nn(n,t.slice()),r=0;r<e.length;r++)this._emit(gt.MIDI2(e[r]))}}T(Tn,(function(t){var n,e;e=Tn[t],bn[n=t]=function(){return new bn(e.apply(this,arguments))},Fn[n]=function(){return this.send(e.apply(this,arguments))}})),T(wn,(function(t){var n,e;n=t,e=wn[t],bn[n]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),new bn(e.apply(this,t))},Fn[n]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),this.send(e.apply(this,t))}})),T(In,(function(t){var n,e;e=In[t],bn[n=t]=function(){var t=Array.prototype.slice.call(arguments);void 0!==this._gr&&(t=[this._gr].concat(t));for(var n=e.apply(this,t),r=0;r<n.length;r++)n[r]=new bn(n[r]);return n},Fn[n]=function(){var t=Array.prototype.slice.call(arguments);void 0!==this._gr&&(t=[this._gr].concat(t));for(var n=e.apply(this,t),r=0;r<n.length;r++)this.send(n[r]);return this}})),T(Bn,(function(t){var n,e;n=t,e=Bn[t],bn[n]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),void 0!==this._ch&&(t=[t[0]].concat([this._ch]).concat(t.slice(1))),new bn(e.apply(this,t))},Fn[n]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),void 0!==this._ch&&(t=[t[0]].concat([this._ch]).concat(t.slice(1))),this.send(e.apply(this,t))}})),T(Pn,(function(t){var n,e;n=t,e=Pn[t],bn[n]=function(){var t=Array.prototype.slice.call(arguments);void 0!==this._gr&&(t=[this._gr].concat(t)),void 0!==this._ch&&(t=[t[0]].concat([this._ch]).concat(t.slice(1)));for(var n=e.apply(this,t),r=0;r<n.length;r++)n[r]=new bn(n[r]);return n},Fn[n]=function(){var t=Array.prototype.slice.call(arguments);void 0!==this._gr&&(t=[this._gr].concat(t)),void 0!==this._ch&&(t=[t[0]].concat([this._ch]).concat(t.slice(1)));for(var n=e.apply(this,t),r=0;r<n.length;r++)this.send(n[r]);return this}})),T(Qt,(function(t){var n,e;e=Qt[t],bn[n=t]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),new bn([16+Et(t[0])].concat(e.apply(this,t.slice(1)),Mn).slice(0,4))},Fn[n]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),this.send([16+Et(t[0])].concat(e.apply(this,t.slice(1)),Mn).slice(0,4))}})),T(Zt,(function(t){kn(t,Zt[t])})),T(Jt,(function(t){kn(t,Jt[t])})),T(Yt,(function(t){var n,e;n=t,e=Yt[t],bn[n]=function(){var t=Array.prototype.slice.call(arguments);void 0!==this._gr&&(t=[this._gr].concat(t)),void 0!==this._ch&&(t=[t[0]].concat([this._ch]).concat(t.slice(1)));for(var n=e.apply(this,t.slice(1)),r=0;r<n.length;r++)n[r]=new bn([32+Et(t[0])].concat(n[r],Mn).slice(0,4));return n},Fn[n]=function(){var t=Array.prototype.slice.call(arguments);void 0!==this._gr&&(t=[this._gr].concat(t)),void 0!==this._ch&&(t=[t[0]].concat([this._ch]).concat(t.slice(1)));for(var n=e.apply(this,t.slice(1)),r=this,i=0;i<n.length;i++)r=r.send([32+Et(t[0])].concat(n[i],Mn).slice(0,4));return r}})),T(Kt,(function(t){var n,e;n=t,e=Kt[t],bn[n]=function(){var t=Array.prototype.slice.call(arguments);return void 0!==this._gr&&(t=[this._gr].concat(t)),Nn(Et(t[0]),e.apply(this,t.slice(1)))},Fn[n]=function(){var t=Array.prototype.slice.call(arguments);void 0!==this._gr&&(t=[this._gr].concat(t));for(var n=Nn(Et(t[0]),e.apply(this,t.slice(1))),r=this,i=0;i<n.length;i++)r=r.send(n[i]);return r}})),T($t,(function(t){var n,e;n=t,e=$t[t],bn[n]=function(){var t=Array.prototype.slice.call(arguments);void 0!==this._gr&&(t=[this._gr].concat(t));for(var n=e.apply(this,t.slice(1)),r=[],i=0;i<n.length;i++)r=r.concat(Nn(Et(t[0]),n[i]));return r},Fn[n]=function(){var t=Array.prototype.slice.call(arguments);void 0!==this._gr&&(t=[this._gr].concat(t));for(var n=e.apply(this,t.slice(1)),r=this,i=0;i<n.length;i++)for(var o=Nn(Et(t[0]),n[i]),s=0;s<o.length;s++)r=r.send(o[s]);return r}})),Rn(H),bn.prototype.getTempo=function(){if(this.isTempo())return(this[4]<<24)+(this[5]<<16)+(this[6]<<8)+this[7]},bn.prototype.getBPM=function(){var t=this.getTempo();if(t)return Math.round(6e9/t)},bn.prototype.getTimeSignature=function(){if(this.isTimeSignature())return[this[4],1<<this[5]]},bn.prototype.getTicksPQN=function(){if(this.isTicksPQN())return(this[2]<<8)+this[3]},bn.prototype.getDelta=function(){if(this.isDelta())return((15&this[1])<<16)+(this[2]<<8)+this[3]},bn.prototype.getStatus=function(){return this.isFlex()?this[1]>>6:this.isData()||this.isSX()?this[1]>>4:void 0},bn.prototype.isTempo=function(){return this[0]>>4==13&&this[1]>>4==1&&0==this[2]&&0==this[3]},bn.prototype.isTimeSignature=function(){return this[0]>>4==13&&this[1]>>4==1&&0==this[2]&&1==this[3]},bn.prototype.isTicksPQN=function(){return 0==this[0]&&this[1]>>4==3},bn.prototype.isDelta=function(){return 0==this[0]&&this[1]>>4==4},bn.prototype.isStartClip=function(){return this.match([240,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0])},bn.prototype.isEndClip=function(){return this.match([240,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0])},bn.prototype.isData=function(){return 80==(240&this[0])},bn.prototype.isFlex=function(){return 208==(240&this[0])},bn.prototype.isText=function(){return 208==(240&this[0])&&(1==this[2]||2==this[2])},bn.prototype.isSX=function(){return 48==(240&this[0])},bn.prototype.isNoteOn=function(){var t=(this[0]||0)>>4,n=(this[1]||0)>>4;return 4==t?9==n:2==t&&(9==n&&!!this[3])},bn.prototype.isNoteOff=function(){var t=(this[0]||0)>>4,n=(this[1]||0)>>4;return 4==t?8==n:2==t&&(8==n||9==n&&!this[3])},bn.prototype.label=St.prototype.label,bn.prototype.toString=St.prototype.toString,bn.prototype._str=function(){var t=this._string();return t?fn(this)+" -- "+t:fn(this)},bn.prototype._string=function(){var t,n,e,r=this[0]>>4;return 1==r||2==r?new St(this.slice(1))._string():(0==r?n=["NOOP","JR Clock","JR Timestamp","Ticks Per Quarter Note","Delta Ticks"][t=this[1]>>4]:3==r?n="SysEx":4==r?(n={0:"Registered Per-Note Controller",1:"Assignable Per-Note Controller",2:"Registered Controller",3:"Assignable Controller",4:"Relative Registered Controller",5:"Relative Assignable Controller",6:"Per-Note Pitch Bend",8:"Note Off",9:"Note On",10:"Poly Pressure",11:"Control Change",12:"Program Change",13:"Channel Pressure",14:"Pitch Bend",15:"Per-Note Management"}[t=this[1]>>4],11==t&&(n={84:"Portamento"}[this[2]]||n),2==t&&(e={"0000":"Pitch Bend Sensitivity","0001":"Fine Tuning","0002":"Coarse Tuning","0003":"Select Tuning Program","0004":"Select Tuning Bank","0005":"Vibrato Depth Range","7f7f":"NONE"}[cn(this[2])+""+cn(this[3])])&&(n+=": "+e)):5==r?n="Data":13==r&&(0==(t=this[2])?(n={0:"Tempo ",1:"Time Signature ",2:"Metronome",5:"Key Signature",6:"Chord Name"}[t=this[3]],0==t?n+=this.getBPM()+" BPM":1==t&&(n+=this.getTimeSignature().join("/"))):1==t?n={0:"Metadata",1:"Project Name",2:"Composition Name",3:"Clip Name",4:"Copyright",5:"Composer Name",6:"Lyricist Name",7:"Arranger Name",8:"Publisher Name",9:"Primary Performer Name",10:"Accompanying Performer Name",11:"Recording Date",12:"Recording Location"}[t=this[3]]||"Unknown Text":2==t&&(n={0:"Text",1:"Lyrics",2:"Lyrics Language",3:"Ruby",4:"Ruby Language"}[t=this[3]]||"Unknown Text")),15==r&&(n={32:"Start of Clip",33:"End of Clip"}[this[1]]),n)},bn.prototype._stamp=St.prototype._stamp,bn.prototype._unstamp=St.prototype._unstamp,bn.prototype._stamped=St.prototype._stamped,bn.prototype.match=St.prototype.match,gt.UMP=bn,S.prototype.UMP=bn,gt.MIDI2=bn,S.prototype.MIDI2=bn,gt.M2M1=function(){var t=new j;return t._sx=[],t._receive=Gn,t._resume(),t.MIDI2()},S.prototype.M2M1=gt.M2M1,gt.M1M2=function(){var t=new j;return t._receive=jn,t._resume(),t},S.prototype.M1M2=gt.M1M2,gt.lib={},gt.lib.now=c,gt.lib.schedule=h;var zn,Un,Vn=[],Wn=0;try{var Zn=URL.createObjectURL(new Blob(["(",function(){!function t(){postMessage({}),setTimeout(t,0)}()}.toString(),")()"],{type:"application/javascript"})),Jn=function(){for(var t=Vn.length,n=0;n<t;n++)Vn.shift()();++Wn>20&&zn&&(zn.terminate(),zn=void 0)},Xn=function(t){Vn.push(t),Wn=0,zn||((zn=new Worker(Zn)).onmessage=Jn)};Xn((function(){gt.lib.schedule=Xn}))}catch(t){}gt.lib.openMidiOut=function(t,n){var e=new j;return n._openOut(e),e._info=n._info(t),e},gt.lib.openMidiIn=function(t,n){var e=new j;return n._openIn(e),e._info=n._info(t),e},gt.lib.registerMidiOut=function(t,n){for(var e=n._info(t),r=0;r<it._outs.length;r++)if(it._outs[r].name==e.name)return!1;return e.engine=n,it._outs.push(e),I&&(N(),I._bad&&(I._repair(),I._resume())),!0},gt.lib.registerMidiIn=function(t,n){for(var e=n._info(t),r=0;r<it._ins.length;r++)if(it._ins[r].name==e.name)return!1;return e.engine=n,it._ins.push(e),I&&(N(),I._bad&&(I._repair(),I._resume())),!0},gt.lib.copyMidiHelpers=on,gt.lib.copyMidi2Helpers=Rn,gt.lib.copyUmpHelpers=Rn,gt.lib.getAudioContext=function(){return function(){if(!Un&&"undefined"!=typeof window){var t=window.AudioContext||window.webkitAudioContext;if(t){(Un=new t)&&!Un.createGain&&(Un.createGain=Un.createGainNode);var n=function(){if("running"!=Un.state){Un.resume();var t=Un.createOscillator(),e=Un.createGain();try{e.gain.value=0}catch(t){}e.gain.setTargetAtTime(0,Un.currentTime,.01),t.connect(e),e.connect(Un.destination),t.start||(t.start=t.noteOn),t.stop||(t.stop=t.noteOff),t.start(.1),t.stop(.11)}else"undefined"!=typeof document&&(document.removeEventListener("touchstart",n),document.removeEventListener("touchend",n),document.removeEventListener("mousedown",n),document.removeEventListener("keydown",n))};"undefined"!=typeof document&&(document.addEventListener("touchstart",n),document.addEventListener("touchend",n),document.addEventListener("mousedown",n),document.addEventListener("keydown",n)),n()}}}(),Un};var Hn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";gt.lib.fromBase64=function(t){var n,e,r,i,o,s,u="",a=0;for(t=t.replace(/[^A-Za-z0-9+/=]/g,"");a<t.length;)n=Hn.indexOf(t.charAt(a++))<<2|(i=Hn.indexOf(t.charAt(a++)))>>4,e=(15&i)<<4|(o=Hn.indexOf(t.charAt(a++)))>>2,r=(3&o)<<6|(s=Hn.indexOf(t.charAt(a++))),u+=String.fromCharCode(n),64!=o&&(u+=String.fromCharCode(e)),64!=s&&(u+=String.fromCharCode(r));return u},gt.lib.toBase64=function(t){var n,e,r,i,o,s=0,u=0,a="",c=[];if(!t)return t;do{n=(o=t.charCodeAt(s++)<<16|t.charCodeAt(s++)<<8|t.charCodeAt(s++))>>18&63,e=o>>12&63,r=o>>6&63,i=63&o,c[u++]=Hn.charAt(n)+Hn.charAt(e)+Hn.charAt(r)+Hn.charAt(i)}while(s<t.length);a=c.join("");var h=t.length%3;return h?a.slice(0,h-3)+"===".slice(h):a},gt.lib.fromUTF8=function(t){t=void 0===t?"":""+t;var n,e,r,i="";for(n=0;n<t.length;n++){if((e=t.charCodeAt(n))>255)return t;if(e<128)i+=t[n];else if(192==(224&e)){if(e=(31&e)<<6,++n>=t.length)return t;if(128!=(192&(r=t.charCodeAt(n))))return t;e+=63&r,i+=String.fromCharCode(e)}else if(224==(240&e)){if(e=(15&e)<<12,++n>=t.length)return t;if(128!=(192&(r=t.charCodeAt(n))))return t;if(e+=(63&r)<<6,++n>=t.length)return t;if(128!=(192&(r=t.charCodeAt(n))))return t;e+=63&r,i+=String.fromCharCode(e)}else if(240==(248&e)){if(e=(7&e)<<18,++n>=t.length)return t;if(128!=(192&(r=t.charCodeAt(n))))return t;if(e+=(63&r)<<12,++n>=t.length)return t;if(128!=(192&(r=t.charCodeAt(n))))return t;if(e+=(63&r)<<6,++n>=t.length)return t;if(128!=(192&(r=t.charCodeAt(n))))return t;if((e+=63&r)>1114111)return t;e-=65536,i+=String.fromCharCode(55296+(e>>10)),i+=String.fromCharCode(56320+(1023&e))}}return i},gt.lib.toUTF8=function(t){t=void 0===t?"":""+t;var n,e,r="";for(n=0;n<t.length;n++)(e=t.charCodeAt(n))<128?r+=t[n]:e<2048?(r+=String.fromCharCode(192+(e>>6)),r+=String.fromCharCode(128+(63&e))):e<65536?(r+=String.fromCharCode(224+(e>>12)),r+=String.fromCharCode(128+(e>>6&63)),r+=String.fromCharCode(128+(63&e))):(r+=String.fromCharCode(240+(e>>18)),r+=String.fromCharCode(128+(e>>12&63)),r+=String.fromCharCode(128+(e>>6&63)),r+=String.fromCharCode(128+(63&e)));return r};var Qn=[],Kn={},Yn={},$n=o.Promise;function te(t,n,e){this.name=t,this.message=n,this.code=e}function ne(t,n){this.bubbles=!1,this.cancelBubble=!1,this.cancelable=!1,this.currentTarget=n,this.defaultPrevented=!1,this.eventPhase=0,this.path=[],this.port=t,this.returnValue=!0,this.srcElement=n,this.target=n,this.timeStamp=c(),this.type="statechange"}function ee(t,n){this.bubbles=!1,this.cancelBubble=!1,this.cancelable=!1,this.currentTarget=t,this.data=n,this.defaultPrevented=!1,this.eventPhase=0,this.path=[],this.receivedTime=c(),this.returnValue=!0,this.srcElement=t,this.target=t,this.timeStamp=this.receivedTime,this.type="midimessage"}function re(t,n){t&&(t.onstatechange&&t.onstatechange(new ne(t,t)),n.onstatechange&&n.onstatechange(new ne(t,n)))}function ie(t,n){var e=this,r=!1,i=null,o=null;this.type="input",this.id=n.id,this.name=n.name,this.manufacturer=n.man,this.version=n.ver,Object.defineProperty(this,"state",{get:function(){return n.connected?"connected":"disconnected"},enumerable:!0}),Object.defineProperty(this,"connection",{get:function(){return r?n.proxy?"open":"pending":"closed"},enumerable:!0}),Object.defineProperty(this,"onmidimessage",{get:function(){return o},set:function(t){p(t)?(o=t,r||e.open().then(f,f)):o=null},enumerable:!0}),Object.defineProperty(this,"onstatechange",{get:function(){return i},set:function(t){i=p(t)?t:null},enumerable:!0}),this.open=function(){return new $n((function(i,o){r?i(e):n.open().then((function(){r||(r=!0,re(e,t)),i(e)}),(function(){o(new te("InvalidAccessError","Port is not available",15))}))}))},this.close=function(){return new $n((function(i){r&&(r=!1,n.close(),re(e,t)),i(e)}))},Object.freeze(this)}function oe(t){for(var n,e;t.length;){for(n=0;n<t.length&&!(t[n]==parseInt(t[n])&&t[n]>=128&&t[n]<=255&&247!=t[n]);n++);if(t.splice(0,n),!t.length)return;if(240==t[0]){for(n=1;n<t.length&&247!=t[n];n++);if(n==t.length)return;return t.splice(0,n+1)}if((e=ue(t[0])+1)>t.length)return;for(n=1;n<e&&!(t[n]!=parseInt(t[n])||t[n]<0||t[n]>=128);n++);if(n==e)return t.splice(0,n);t.splice(0,n)}}function se(n,e,r,i){var o=this;this.id=n,this.name=e,this.man=r,this.ver=i,this.connected=!0,this.ports=[],this.pending=[],this.proxy=void 0,this.queue=[],this.onmidi=function(n){var e;for(o.queue=o.queue.concat(n.slice()),e=oe(o.queue);e;e=oe(o.queue))for(t=0;t<o.ports.length;t++)o.ports[t][0].onmidimessage&&(240!=e[0]||o.ports[t][1])&&o.ports[t][0].onmidimessage(new ee(o,new Uint8Array(e)))}}function ue(t){return t>=128&&t<=191||t>=224&&t<=239||242==t?2:t>=192&&t<=223||241==t||243==t?1:0}"function"!=typeof $n&&(($n=function(t){this.executor=t}).prototype.then=function(t,n){"function"!=typeof t&&(t=f),"function"!=typeof n&&(n=f),this.executor(t,n)}),se.prototype.open=function(){var t=this;return new $n((function(n,e){var r;t.proxy||!t.connected?n():(t.pending.push([n,e]),1==t.pending.length&&gt().openMidiIn(t.name).or((function(){for(r=0;r<t.pending.length;r++)t.pending[r][1]();t.pending=[]})).and((function(){for(t.proxy=this,t.proxy.connect(t.onmidi),r=0;r<t.pending.length;r++)t.pending[r][0]();t.pending=[]})))}))},se.prototype.close=function(){var t;if(this.proxy){for(t=0;t<this.ports.length;t++)if("open"==this.ports[t].connection)return;this.proxy.close(),this.proxy=void 0}},se.prototype.disconnect=function(){this.connected=!1,this.proxy&&(this.proxy.close(),this.proxy=void 0)},se.prototype.reconnect=function(){var t,n,e=this,r=[];for(this.connected=!0,t=0;t<Qn.length;t++)"closed"==(n=Qn[t].inputs.get(this.id)).connection?re(n,Qn[t]):r.push([n,Qn[t]]);r.length&&gt()._openMidiInNR(e.name).or((function(){for(t=0;t<r.length;t++)r[t][0].close()})).and((function(){for(e.proxy=this,e.proxy.connect(e.onmidi),t=0;t<r.length;t++)re(r[t][0],r[t][1])}))};var ae="Failed to execute 'send' on 'MIDIOutput': ";function ce(t,n){var e=this,r=!1,i=null;this.type="output",this.id=n.id,this.name=n.name,this.manufacturer=n.man,this.version=n.ver,Object.defineProperty(this,"state",{get:function(){return n.connected?"connected":"disconnected"},enumerable:!0}),Object.defineProperty(this,"connection",{get:function(){return r?n.proxy?"open":"pending":"closed"},enumerable:!0}),Object.defineProperty(this,"onstatechange",{get:function(){return i},set:function(t){i=p(t)?t:null},enumerable:!0}),this.open=function(){return new $n((function(i,o){r?i(e):n.open().then((function(){r||(r=!0,re(e,t)),i(e)}),(function(){o(new te("InvalidAccessError","Port is not available",15))}))}))},this.close=function(){return new $n((function(i){r&&(r=!1,e.clear(),n.close(),re(e,t)),i(e)}))},this.clear=function(){},this.send=function(i,o){if(function(t,n){var e,r,i,o=[];for(e=0;e<t.length;e++)if(t[e]!=parseInt(t[e])||t[e]<0||t[e]>255)throw TypeError(ae+t[e]+" is not a UInt8 value.");for(r=0,e=0;e<t.length;e++)if(r){if(t[e]>127)throw TypeError(ae+"Unexpected status byte at index "+e+" ("+t[e]+").");i.push(t[e]),r--}else{if(t[e]<128)throw TypeError(ae+"Running status is not allowed at index "+e+" ("+t[e]+").");if(247==t[e])throw TypeError(ae+"Unexpected end of system exclusive message at index "+e+" ("+t[e]+").");if(i=[t[e]],o.push(i),240==t[e]){if(!n)throw new te("InvalidAccessError",ae+"System exclusive messag is not allowed at index "+e+" ("+t[e]+").",15);for(r=-1;e<t.length;e++)if(i.push(t[e]),247==t[e]){r=0;break}}else r=ue(t[e])}if(r)throw TypeError(ae+"Message is incomplete")}(i,t.sysexEnabled),!n.connected)throw new te("InvalidStateError","Port is not connected",11);if(r){var s=c();o>s?setTimeout((function(){n.proxy.send(i)}),o-s):n.proxy.send(i)}else this.open().then((function(){e.send(i,o)}),f)},Object.freeze(this)}function he(t,n,e,r){this.id=t,this.name=n,this.man=e,this.ver=r,this.connected=!0,this.ports=[],this.pending=[],this.proxy=void 0}function fe(t){this.has=function(n){return t.hasOwnProperty(n)&&t[n].connected},this.keys=function(){try{var n=new Map;for(var e in t)this.has(e)&&n.set(e,this.get(e));return n.keys()}catch(t){}},this.values=function(){try{var n=new Map;for(var e in t)this.has(e)&&n.set(e,this.get(e));return n.values()}catch(t){}},this.entries=function(){try{var n=new Map;for(var e in t)this.has(e)&&n.set(e,this.get(e));return n.entries()}catch(t){}},this.forEach=function(n,e){for(var r in void 0===e&&(e=this),t)this.has(r)&&n.call(e,this.get(r),r,this)},Object.defineProperty(this,"size",{get:function(){var n=0;for(var e in t)this.has(e)&&n++;return n},enumerable:!0})}function pe(t,n){this.get=function(e){if(Yn.hasOwnProperty(e)&&Yn[e].connected)return n[e]||(n[e]=new ie(t,Yn[e]),Yn[e].ports.push([n[e],t.sysexEnabled])),n[e]},Object.freeze(this)}function le(t,n){this.get=function(e){if(Kn.hasOwnProperty(e)&&Kn[e].connected)return n[e]||(n[e]=new ce(t,Kn[e]),Kn[e].ports.push([n[e],t.sysexEnabled])),n[e]},Object.freeze(this)}function de(t){var n,e,r,i;for(n=0;n<t.inputs.added.length;n++)r=t.inputs.added[n],Yn.hasOwnProperty(r.id)||(Yn[r.id]=new se(r.id,r.name,r.manufacturer,r.version)),Yn[r.id].reconnect();for(n=0;n<t.outputs.added.length;n++)r=t.outputs.added[n],Kn.hasOwnProperty(r.id)||(Kn[r.id]=new he(r.id,r.name,r.manufacturer,r.version)),Kn[r.id].reconnect();for(n=0;n<t.inputs.removed.length;n++)if(r=t.inputs.removed[n],Yn.hasOwnProperty(r.id)){for(i=[],e=0;e<Qn.length;e++)i.push([Qn[e].inputs.get(r.id),Qn[e]]);for(Yn[r.id].disconnect(),e=0;e<i.length;e++)re(i[e][0],i[e][1])}for(n=0;n<t.outputs.removed.length;n++)if(r=t.outputs.removed[n],Kn.hasOwnProperty(r.id)){for(i=[],e=0;e<Qn.length;e++)i.push([Qn[e].outputs.get(r.id),Qn[e]]);for(Kn[r.id].disconnect(),e=0;e<i.length;e++)re(i[e][0],i[e][1])}}function me(t){var n,e,r=null;this.sysexEnabled=t,this.inputs=new pe(this,{}),this.outputs=new le(this,{}),Object.defineProperty(this,"onstatechange",{get:function(){return r},set:function(t){r=p(t)?t:null},enumerable:!0}),Object.freeze(this);var i=I._info;for(n=0;n<i.inputs.length;n++)e=i.inputs[n],Yn.hasOwnProperty(e.id)||(Yn[e.id]=new se(e.id,e.name,e.manufacturer,e.version));for(n=0;n<i.outputs.length;n++)e=i.outputs[n],Kn.hasOwnProperty(e.id)||(Kn[e.id]=new he(e.id,e.name,e.manufacturer,e.version));Qn.length||gt().onChange(de),Qn.push(this)}return he.prototype.open=function(){var t=this;return new $n((function(n,e){var r;t.proxy||!t.connected?n():(t.pending.push([n,e]),1==t.pending.length&&gt().openMidiOut(t.name).or((function(){for(r=0;r<t.pending.length;r++)t.pending[r][1]();t.pending=[]})).and((function(){for(t.proxy=this,r=0;r<t.pending.length;r++)t.pending[r][0]();t.pending=[]})))}))},he.prototype.close=function(){var t;if(this.proxy){for(t=0;t<this.ports.length;t++)if("open"==this.ports[t].connection)return;this.proxy.close(),this.proxy=void 0}},he.prototype.disconnect=function(){this.connected=!1,this.proxy&&(this.proxy.close(),this.proxy=void 0)},he.prototype.reconnect=function(){var t,n,e=this,r=[];for(this.connected=!0,t=0;t<Qn.length;t++)"closed"==(n=Qn[t].outputs.get(this.id)).connection?re(n,Qn[t]):r.push([n,Qn[t]]);r.length&&gt()._openMidiOutNR(e.name).or((function(){for(t=0;t<r.length;t++)r[t][0].close()})).and((function(){for(e.proxy=this,t=0;t<r.length;t++)re(r[t][0],r[t][1])}))},pe.prototype=new fe(Yn),pe.prototype.constructor=pe,le.prototype=new fe(Kn),le.prototype.constructor=le,gt.requestMIDIAccess=function(t){return new $n((function(n,e){gt.JZZ(t).or((function(){})).and((function(){var r=!(!t||!t.sysex);if(r&&!this.info().sysex)e(new te("SecurityError","Sysex is not allowed",18));else{var i=new me(r);n(i)}}))}))},"undefined"==typeof navigator||navigator.requestMIDIAccess||(navigator.requestMIDIAccess=gt.requestMIDIAccess),gt.close=function(){rt._close&&rt._close()},gt}));
//# sourceMappingURL=/sm/ef53e9d0209352e308773e6d306a5be60b6033a5b6786fa68ac1cce70b6e7618.map